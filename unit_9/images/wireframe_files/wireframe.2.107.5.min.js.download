function updateCanvasInput(e,t){var a=e?e:parseInt($canvaswrap.width(),10),i=t?t:parseInt($canvaswrap.height(),10);$(".canvassize").html("<b>canvas</b>: "+a+"/"+i+"px"),$("#canvas_w_val").val(a),$("#canvas_h_val").val(i),computeGuides("#canvas")}function setgrid(){if(!$("#canvas #grid-div").length){$("#canvas").prepend($(".grids").show().contents().unwrap()),$("#show-grid").attr("checked",!0);var e=$canvaswrap.attr("data-grid-type")||$canvaswrap.attr("data-grid");switch(e){case"graph":$("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("select#grid-type").val("graph");break;case"dots":$("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$("select#grid-type").val("dots");break;case"false":$("#grid-div , #grid-dot , #gridcol").hide(),$("#show-grid").attr("checked",!1);break;default:$("#grid-div , #grid-dot , #gridcol").hide(),$("#show-grid").attr("checked",!1)}"true"===$canvaswrap.attr("data-col")&&($("#grid-div , #grid-dot ").hide(),$("#gridcol").show(),$("#show-grid").attr("checked",!1),$("#show-columns").attr("checked",!0),computeGuides("col"))}gridsize=$canvaswrap.attr("data-grid-size")||$canvaswrap.attr("snappy"),gridsize>0?($canvaswrap.removeAttr("snappy"),$(".grid-size-val").text(gridsize),$snaptogrid.attr("checked",!0),$("#show-columns").attr("checked",!1),$("#gridcol").hide(),appSettings.snapToGuides=!1,appSettings.snapToGrid=!0,appSettings.snapToCol=!1,$snaptoguides.attr("checked",!1),updategrid(gridsize),$("#grid-slider").slider("value",gridsize)):"col"==gridsize&&$canvaswrap.data("col")||$canvaswrap.data("col")?($snaptogrid.attr("checked",!1),$snaptoguides.attr("checked",!0),$("#show-columns").attr("checked",!0),appSettings.snapToGuides=!0,appSettings.snapToGrid=!1,appSettings.snapToCol=!0,$selectgridtype.val("col"),gridsize=0,$("#gridcol").show()):(updategrid(20),$("#grid-slider").slider("value",20));$canvaswrap.attr("data-grid-show")}function lock(){if(multipaged)var e=$("#canvas .page:visible .selected");else var e=$("#canvas .selected");e.length&&!$("#canvas .selected.locked").length?(e.addClass("locked , icon-").draggable("destroy").resizable("destroy"),saveState(e)):$("#canvas .selected.locked").length&&($("#canvas .selected.locked").removeClass("locked icon-").unbind("click").data("draggable",!1),$("#lock").removeClass("pressed"),makeDrag(e))}function unlock(e){e.removeClass("locked icon-").unbind("click").data("draggable",!1),$("#lock").removeClass("pressed"),makeDrag(e)}function showSaveButton(){$("#slogan").fadeOut("fast",function(){$(".controls").fadeIn(),$("#links").addClass("linksmin")})}function InstantShowSaveButton(){$("#slogan").hide(),$("#links").addClass("linksmin"),$("#demo").hide(),$(".controls").show()}function edittext(e,t){if(!previewMode){supercanvas.boxer("destroy");var a=$canvas.find(".selected .textme"),i=a.parents(".wire");saveState(i),i.resizable("destroy").draggable("destroy").removeClass("selected").addClass("editingtext").css("z-index",99999999).find(".wirejr").css("height","auto"),a.attr({contenteditable:!0,spellcheck:!1}).focus().selectText(),a.focus()}}function focustext(){activepage.find(".editingtext [contenteditable=true]").focus()}function unselectAll(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function modernizeWire(){$canvas.find(".textme").attr("contenteditable",!1)}function textblur(){previewMode||useboxer();{var e=$canvas.find(".editingtext");e.css("height")}e.parent().parent().parent().css("z-index","auto");var t=e.val().replace(/\n/gi,"<br>"),a=$("<div>");""===t&&(t="..."),a.html(t).addClass("textme"),e.replaceWith(a),a.closest(".wire").css({height:a.height(),position:"absolute"}),a.closest(".wirejr").draggable("destroy"),$("textarea.editingtext").remove()}function divClicked(e){supercanvas.boxer("destroy"),$(this).parent().addClass("latest");var t=$(this).html().replace(/<br>/gi,"\n"),a=$("<textarea class='editingtext'/>");a.val($("<div />").html(t).text()).addClass("textareanow"),$(this).replaceWith(a),a.focus(),a.blur(editableTextBlurred),$(".latest .ok").show(),$("textarea").autoResize(),$(".annotbox").addClass("textareainside"),$(".ok").click(editableTextBlurred)}function editableTextBlurred(){previewMode||useboxer(),$t=$(".textareanow"),$t.parent().removeClass("latest");var e=$t.val().replace(/\n/gi,"<br>"),t=$("<div>");""===e&&(e="..."),t.html(e).insertBefore($t).click(divClicked),$t.remove(),$(".ok").hide(),previewMode&&(saveComment(),t.parent().parent().draggable({cancel:".annotbox , .closeannot",cursor:"move"}).resizable({handles:"all"}))}function selectColliders(e){var t={},a=activepage.find(".selecting");t.top=e.box.position().top,t.left=e.box.position().left,t.right=e.box.position().left+Number(a.width()),t.bottom=e.box.position().top+Number(a.height());$();activepage.find(".wire").not(".brandnew, .locked, .groupmember").each(function(){var e={};e.top=$(this).position().top,e.left=$(this).position().left,e.right=Number($(this).position().left)+Number($(this).width()),e.bottom=Number($(this).position().top)+Number($(this).height()),t.right>=e.right&&t.left<=e.left&&t.top<=e.top&&t.bottom>=e.bottom&&$(this).addClass("selected")})}function findColliders(){var e={},t=activepage.find(".brandnew");e.top=t.offset().top/zoomfactor,e.left=t.offset().left/zoomfactor,e.right=Number(t.offset().left/zoomfactor)+Number(t.width()),e.bottom=Number(t.offset().top/zoomfactor)+Number(t.height());var a=$();activepage.find(".wire").not(".brandnew, .locked, .groupmember").each(function(){var t={};t.top=$(this).offset().top/zoomfactor,t.left=$(this).offset().left/zoomfactor,t.right=Number($(this).offset().left/zoomfactor)+Number($(this).width()),t.bottom=Number($(this).offset().top/zoomfactor)+Number($(this).height()),e.right>=t.right&&e.left<=t.left&&e.top<=t.top&&e.bottom>=t.bottom&&($(this).addClass("selected"),a=a.add($(this)))})}function useboxer(){supercanvas.boxer({cursor:"pointer",stop:function(e,t){if(draggingInProgress=!1,$(".brandnew").hasClass("selecting"))selectColliders(t),$canvas.find(".selected.locked").length&&0===$canvas.find(".selected:not(.locked)").length&&$("#lock").addClass("pressed"),$canvas.find(".selected.grouped").length&&0===$canvas.find(".selected:not(.grouped)").length&&$("#group").addClass("pressed"),$("#canvas .brandnew").remove();else{var a=(t.box.height(),t.box.width());if(t.box.width()>10||t.box.height()>10){$("#icons").show().siblings().hide(),aspect_ratio($("#canvas .blank")),$("#annotate").show(),$("#textinput").removeClass("lasticon");var i=t.box.position(),s=i.top,n=i.left,r=$("#canvas-wrap").position(),o=s+r.top-40,d=wirepanel.width(),c=n+a/2-d/2+r.left;0>=c&&(c=0),wirepanel.css({top:o,left:c}),wirepanel.show()}else t.box.remove()}}})}function prepareWire(){var e=$(".brandnew"),t=e.height();if(e.removeAttr("class").addClass("wirejr brandnew blank latestwire").empty().css({background:defbgcolor,width:clonewidth-2*defbw+(gridsize>0?1:0),height:cloneheight-2*defbw+(gridsize>0?1:0),"border-width":defbw+"px","border-color":defstrcolor,color:defstrcolor}),e.addClass(type).css("margin-top",0),"annotate"==type&&$(".brandnew.annotate").removeClass("wire").addClass("aa").append(annotationhtml).draggable({cancel:".annotbox , .closeannot",cursor:"move"}),("slider2"==type||"line_hor"==type)&&e.addClass("resizeX"),"slider"==type&&e.css("margin-top",t/2-3).removeClass("slider").addClass("slider2").append("<span>").find("span").css("background",defstrcolor),"line_hor"==type&&e.css("margin-top",t/2),"paragraph"==type&&e.append(paragraph).find("span").css("background",defstrcolor),"textinput"==type&&e.removeClass("textinput").addClass("textinput2").append("<span>|</span>"),"combobox"==type&&e.removeClass("combobox").addClass("combobox2").append("<span>&#9660;</span>"),"scrollh"==type&&e.removeClass("scrollh").addClass("scrollh2").append("<span class='arrL'>&#9664;</span>").append("<span >&#9654;</span>"),"progressbar"==type&&e.removeClass("progressbar").addClass("progressbar2").append("<span></span>"),"list"==type&&e.append(list).find("span").css("background",defstrcolor),"headlinetxt"==type&&e.addClass("lastheadline textnew text20 text-arimo ").css("height",21*Math.floor(t/21)).append(texthtml).find(".textme").append(paragraphtext),e.hasClass("headline")&&$(".brandnew.headline").html(headtxt).find(".headtext span").css("background",defstrcolor),e.hasClass("image")){e.svg();var a=e.width(),i=e.height(),s=e.svg("get");s.line(0,i,a,0,{"class":"line1",stroke:defstrcolor,strokeWidth:defbw}),s.line(0,0,a,i,{"class":"line2",stroke:defstrcolor,strokeWidth:defbw}),e.addClass("hasSVG")}}function insertWire(){if($(".brandnew").length){if("annotate"!==type){var e=$(".brandnew");e.wrap("<div class='wire'></div>");var t=e.closest(".wire"),a=e.width(),i=e.height(),s=e.position(),n=s.top,r=s.left,o=parseInt(e.css("zIndex"),10),d="w"+(new Date).getTime();saveState("",[d]),t.css({top:n,left:r,width:a+2*defbw,height:i+2*defbw}).attr("id",d),e.css("cssText","border-width:"+defbw+"px;border-color:"+defstrcolor+";color:"+defstrcolor+";background:"+defbgcolor+";z-index:"+o+";"),e.is(".aa")&&e.css("z-index","5000").removeClass("wirejr")}else $(".brandnew").removeClass("wirejr").css("z-index",5e3);if("headlinetxt"==type){e.css({height:i,width:a}).parent().addClass("hastext selected text20 text-lorem editingtext");var c=e.find(".textme").getShowingText();$(".textnew.lastheadline").removeClass("lastheadline thelatest").attr("data-lorem-count",c.count),e.find(".textme").html(c.text),mousedownHappened=!1,editme(t)}if("annotate"==type&&($(".editme").click(divClicked),$(".thelatest").click(),$(".closeannot").click(function(){var e=$(this).parent();e.remove()})),computeGuides(t),$(".brandnew").removeClass("blank brandnew"),wirePresent){var l=$canvas.find(".wire").length;l>0&&(showSaveButton(),wirePresent=!1)}"headlinetxt"!==type?wirepanel.hide():focustext()}}function makeDrag(e){e.filter(".locked").data("draggable",!0).click(function(e){var t=$(this);0!=$("#canvas .brandnew").length||0!==$("#canvas .selected:not(.locked)").length||t.hasClass(".selected")||(t.addClass("selected"),$("#lock").addClass("pressed")),(event.ctrlKey||event.shiftKey||event.metaKey)&&(t.toggleClass("selected"),$canvas.find(".selected.locked").length||$("#lock").removeClass("pressed"))});var t,a,i,s,n,r,o,d,c,l=!1;e.not(".groupmember , .wirejr , .locked").draggable({helper:function(e){var t=activepage.find(".wire.selected").not(".locked");if(t.length>1&&$(this).hasClass("selected")){l=!0,t.addClass("multidrag").resizable("destroy"),a=1e5,i=1e5,s=-1,n=-1,t.each(function(){var e=$(this).position(),t=$(this).width(),r=$(this).height();a=a<e.top?a:e.top,i=i<e.left?i:e.left,s=s>e.left+t?s:e.left+t,n=n>e.top+r?n:e.top+r});var r=$("<div/>").css("box-shadow","0 0 0 1px red inset"),o=$("<div/>").css({top:-a,left:-i,width:s-i,height:n-a,position:"relative"}).appendTo(r);return t.clone().resizable("destroy").removeClass("selected").appendTo(o),t.addClass("draggable-original"),r}return l=!1,$(this)},start:function(e,s){draggingInProgress=!0;var n=$(this);$canvaswrap.find(".brandnew").remove(),n.hasClass("selected")?saveState():saveState(n),p=parseInt($(this).css("borderLeftWidth"),10),$(".selected.locked").removeClass("selected"),s.helper.data("draggableXY.originalPosition",s.position||{top:0,left:0}),s.helper.data("draggableXY.newDrag",!0),t=$("#canvas .selected:not(.locked)"),l&&(r=n.position().top,o=n.position().left,s.helper.css({"margin-top":a-r,"margin-left":i-o}),c={top:a,left:i},1!=e.altKey?t.addClass("transparent"):t.removeClass("selected")),(!e.shiftKey&&$("#canvas .selected:not(.locked)").length<2||!n.hasClass("selected"))&&$(".selected").removeClass("selected"),$dim.html("<b>W</b>: "+($(this).outerWidth()-1)+"px, <b>H</b>: "+($(this).outerHeight()-1)+"px"),wirepanel.hide(),t.children().removeClass("selected"),posTopArray=[],posLeftArray=[],d={top:parseInt(s.helper.css("margin-top"),10),left:parseInt(s.helper.css("margin-left"),10)},innerOffsetX=e.pageX-this.offsetLeft,innerOffsetY=e.pageY-this.offsetTop;var h=[];if(activepage.find(" > .wire.selected").each(function(){h.push($(this).attr("id"))}),h.push(n.attr("id")),n.data("thisId",h),n.is(".grouped")){var g=[];n.find("  .groupmember").each(function(){g.push($(this).attr("id"))}),n.data("groupIds",g)}},drag:function(e,t){var a=$(this);if(e.shiftKey){var i=t.helper.data("draggableXY.originalPosition"),s=Math.abs(i.left-t.position.left),n=Math.abs(i.top-t.position.top),r=t.helper.data("draggableXY.newDrag");t.helper.data("draggableXY.newDrag",!1);var o=r?Math.max(s,n)===s:t.helper.data("draggableXY.xMax");t.helper.data("draggableXY.xMax",o);{t.position}o&&$(this).draggable("option","axis","x"),o||$(this).draggable("option","axis","y")}if(e.altKey&&$guidesHV.hide(),appSettings.snapToGuides&&appSettings.transformSnap&&!e.altKey){var c,l,p,h,g,u,f=($("#canvas").offset(),$(this).width()<=24?2:MIN_DISTANCE+1),v=$(this).height()<=24?2:MIN_DISTANCE+1,m=wireDistV=1e3,b=t.helper,w=({top:e.pageY-innerOffsetY,left:e.pageX-innerOffsetX},b.outerWidth()-1),x=b.outerHeight()-1,k=!1,y=!1,C=!1,z=!1;for(var S in guides){g=guides[S].edges,u=S;var M=Math.min(Math.abs(t.position.top+d.top-g.top),Math.abs(t.position.top+d.top-g.bottom),Math.abs(t.position.top+d.top+x-g.top),Math.abs(t.position.top+d.top+x-g.bottom)),I=Math.min(Math.abs(t.position.left+d.left-g.left),Math.abs(t.position.left+d.left-g.right),Math.abs(t.position.left+d.left+w-g.left),Math.abs(t.position.left+d.left+w-g.right));guides.hasOwnProperty(S)&&$.each(guides[S].g,function(e,i){$.inArray(S,a.data("thisId"))>=0||a.data("groupIds")&&$.inArray(S,a.data("groupIds"))>=0||(("h"===i.type||"hm"===i.type)&&(Math.abs(t.position.top+d.top-i.y)<v&&m>I&&(v=!0,l=this,k=!1,y=!1,h=u,m=I),Math.abs(t.position.top+d.top-i.y+x)<v&&m>I&&(v=!0,l=this,k=!0,y=!1,h=u,m=I)),"hm"===i.type&&Math.abs(t.position.top+d.top-i.y+x/2)<v&&m>I&&(y=!0,v=!0,l=this,k=!1,h=u,m=I),("v"===i.type||"vm"===i.type)&&(Math.abs(t.position.left+d.left-i.x)<f&&M<wireDistV&&(f=!0,c=this,C=!1,z=!1,p=u,wireDistV=M),Math.abs(t.position.left+d.left-i.x+w)<f&&M<wireDistV&&(f=!0,c=this,C=!0,z=!1,p=u,wireDistV=M)),"vm"===i.type&&Math.abs(t.position.left+d.left-i.x+w/2)<v&&M<wireDistV&&(z=!0,f=!0,c=this,C=!1,p=u,wireDistV=M))}),(!e.shiftKey||e.shiftKey&&!o)&&(l?($guideH.addClass("visible").css("transform","translateY("+l.y*zoomfactor+"px)").show(),markAadjacentElement(l,h),t.position.top=k?l.y-x-d.top:y?Math.round(l.y-x/2-d.top):l.y-d.top):($guideH.hide(),activepage.find("[data-snap-mark-h]").removeAttr("data-snap-mark-h"))),(!e.shiftKey||e.shiftKey&&o)&&(c?($guideV.addClass("visible").css("transform","translateX("+c.x*zoomfactor+"px)").show(),markAadjacentElement(c,p),t.position.left=C?c.x-w-d.left:z?Math.round(c.x-w/2-d.left):c.x-d.left):($guideV.hide(),activepage.find("[data-snap-mark-v]").removeAttr("data-snap-mark-v")))}}if(gridsize>0&&!e.altKey){var _=t.position.left,T=t.position.top,w=$(this).outerWidth()-1,x=$(this).outerHeight()-1,D=t.position.left+w,A=t.position.top+x;snappedleft=Math.round(_/gridsize)*gridsize,snappedright=Math.round(D/gridsize)*gridsize,snappedtop=Math.round(T/gridsize)*gridsize,snappedbottom=Math.round(A/gridsize)*gridsize;var H=Math.abs(snappedleft-t.position.left),W=Math.abs(snappedright-t.position.left-w),G=Math.abs(snappedtop-t.position.top),V=Math.abs(snappedbottom-t.position.top-x);t.position.left=W>H?snappedleft:snappedright-w,t.position.top=V>G?snappedtop:snappedbottom-x}},stop:function(e,t){$("#guide-v, #guide-h").hide(),draggingInProgress=!1;var s=$(this);if(computeGuides($(this)),activepage.data("altdrag")||activepage.find(".selected").length||s.addClass("selected"),l){draggingInProgress=!1,activepage.find("div.transparent").remove();var n=t.helper.clone().find("> div > .wire"),r=(n.first().parent().parent(),t.helper.position().left+parseInt(t.helper.css("margin-left"))-i),o=t.helper.position().top+parseInt(t.helper.css("margin-top"))-a;n.find(".ui-resizable-handle").remove(),$toApp=$();var d=[];n.each(function(e){$(this).is(".groupmember")&&n.unwrap().unwrap();var t=$(this);abspos={top:parseInt(t.css("top")),left:parseInt(t.css("left"))};var a="w"+(new Date).getTime()+e;t.css({top:abspos.top+o,left:abspos.left+r}),activepage.data("altdrag")&&(t.attr("id",a),d[e]=a),$toApp=$toApp.add(t)}),activepage.find(".draggable-original").removeClass("draggable-original").draggable("destroy"),$toApp.addClass("selected").removeData("draggable").appendTo(activepage),activepage.find(".multidrag").removeClass("multidrag"),makeDrag($toApp),computeGuides($toApp),l=!1,activepage.data("altdrag")&&(activepage.data("altdrag",!1),historystate.shift(),saveState("",d))}$(this).hasClass("altdrag")?$(".altdrag").removeClass("selected altdrag"):$(this).addClass("selected"),$(this).draggable("option","axis","none")}});var p=2;e.not(".groupmember , .wirejr , .locked").resizable({autoHide:!0,start:function(e,t){if(multipaged)var a=$("#canvas .page:visible .selected");else var a=$("#canvas .selected");draggingInProgress=!0,resizingInProgress=!0,$canvas.data({guideH:!1,guideV:!1});var i=$(this);i.data({resizing:!0}),$guidesHV.hide(),i.data("resizable").handle=i.data("resizable").axis,$("#guide-v , #guide-h").hide(),handle=$(this).data("resizable").axis,saveState($(this)),p=parseInt(a.css("borderLeftWidth"),10),wirepanel.hide(),$(this).removeClass("selected"),i.data("thisId",$(this).attr("id"))},resize:function(e,t){var a=$(this),i=a.data("resizable").handle;if(p=1,appSettings.snapToGuides&&appSettings.transformSnap&&!e.altKey){var s,n,r,o,d,c,l,h,g,u,f,u,v=wireDistV=1e3,m={top:t.position.top,left:t.position.left},b=t.size.width,w=t.size.height;o=!1,r=!1;for(var x in guides){g=guides[x].edges,f=x;var k=Math.min(Math.abs(t.position.top-g.top),Math.abs(t.position.top-g.bottom),Math.abs(t.position.top+w-g.top),Math.abs(t.position.top+w-g.bottom)),y=Math.min(Math.abs(t.position.left-g.left),Math.abs(t.position.left-g.right),Math.abs(t.position.left+b-g.left),Math.abs(t.position.left+b-g.right));guides.hasOwnProperty(x)&&$.each(guides[x].g,function(e,t){x!==a.data("thisId")&&($.inArray(x,a.data("thisId"))>=0||$.inArray(x,a.data("thisId"))>=0||(("h"==t.type||"hm"===t.type)&&((u=m.top-t.y)<MIN_DISTANCE+1&&(u=m.top-t.y)>-1*(MIN_DISTANCE+1)&&"s"!==i&&"se"!==i&&"sw"!==i&&v>y&&(o=!0,deltaH=u,n=t,c=0,h=f,v=y),(u=m.top-t.y+w)<MIN_DISTANCE+1&&(u=m.top-t.y+w)>-1*(MIN_DISTANCE+1)&&"n"!==i&&"ne"!==i&&"nw"!==i&&v>y&&(o=!0,deltaH=u,n=t,c=w-1,h=f,v=y)),("v"==t.type||"vm"===t.type)&&((u=m.left-t.x)<MIN_DISTANCE+1&&(u=m.left-t.x)>-1*(MIN_DISTANCE+1)&&"e"!==i&&"ne"!==i&&"se"!==i&&k<wireDistV&&(r=!0,deltaV=u,s=t,d=0,l=f,wireDistV=k),(u=m.left-t.x+b)<MIN_DISTANCE+1&&(u=m.left-t.x+b)>-1*(MIN_DISTANCE+1)&&"w"!==i&&"nw"!==i&&"sw"!==i&&k<wireDistV&&(r=!0,deltaV=u,s=t,d=b,l=f,wireDistV=k))))})}}if(hideGuidesAndMarkers(),o&&("n"==i||"ne"==i||"nw"==i)&&n&&($guideH.addClass("visible").show().css({transform:"translateY("+n.y*zoomfactor+"px)",display:"block"}),t.position.top=n.y-c,t.size.height+=deltaH,markAadjacentElement(n,h)),o&&("s"==i||"sw"==i||"se"==i)&&n&&($guideH.addClass("visible").show().css({transform:"translateY("+n.y*zoomfactor+"px)",display:"block"}),t.size.height-=deltaH-p,markAadjacentElement(n,h)),r&&("w"==i||"sw"==i||"nw"==i)&&s&&($guideV.addClass("visible").show().css({transform:"translateX("+s.x*zoomfactor+"px)",display:"block"}),t.position.left=s.x-d,t.size.width+=deltaV+p-1,markAadjacentElement(s,l)),r&&("e"==i||"se"==i||"ne"==i)&&s&&($guideV.addClass("visible").show().css({transform:"translateX("+s.x*zoomfactor+"px)",display:"block"}),t.size.width-=deltaV-p,markAadjacentElement(s,l)),o||($guideH.hide(),activepage.find("[data-snap-mark-h]").removeAttr("data-snap-mark-h")),r||($guideV.hide(),activepage.find("[data-snap-mark-v]").removeAttr("data-snap-mark-v")),r||o||($guidesHV.hide(),hideGuidesAndMarkers()),$(".ui-resizable-resizing").hasClass("svginside")){var C=t.size.width;$(".ui-resizable-resizing svg ").css("width",C);var z=t.size.height;$(".ui-resizable-resizing svg ").css("height",z)}if($(".ui-resizable-resizing").has("hasSVG")){var C=$(".ui-resizable-resizing").width(),z=$(".ui-resizable-resizing").height(),S=$(".ui-resizable-resizing .line2").attr("stroke-width");$(".ui-resizable-resizing .line1").attr("x2",C-2*S),$(".ui-resizable-resizing .line1").attr("y1",z-2*S),$(".ui-resizable-resizing .line2").attr("x2",C-2*S),$(".ui-resizable-resizing .line2").attr("y2",z-2*S),$(".ui-resizable-resizing svg").attr("height",z-2*S),$(".ui-resizable-resizing svg").attr("width",C-2*S)}if(gridsize>0&&appSettings.snapToGrid&&!e.altKey){var M=t.position.left,I=t.position.top,b=t.size.width,w=t.size.height,_=t.position.left+b,T=t.position.top+w;snappedleft=Math.round(M/gridsize)*gridsize,snappedright=Math.round(_/gridsize)*gridsize,snappedtop=Math.round(I/gridsize)*gridsize,snappedbottom=Math.round(T/gridsize)*gridsize;{Math.abs(snappedleft-t.position.left),Math.abs(snappedright-t.position.left-b),Math.abs(snappedtop-t.position.top),Math.abs(snappedbottom-t.position.top-w)}"se"==i&&(t.size.width=snappedright-M+1,t.size.height=snappedbottom-I+1),"e"==i&&(t.size.width=snappedright-M+1),"s"==i&&(t.size.height=snappedbottom-I+1),"w"==i&&(t.size.width=_-snappedleft,t.position.left=snappedleft),"n"==i&&(t.size.height=T-snappedtop,t.position.top=snappedtop),"nw"==i&&(t.size.height=T-snappedtop,t.position.top=snappedtop,t.size.width=_-snappedleft,t.position.left=snappedleft),"ne"==i&&(t.size.height=T-snappedtop,t.position.top=snappedtop,t.size.width=snappedright-M+1),"sw"==i&&(t.size.width=_-snappedleft,t.position.left=snappedleft,t.size.height=snappedbottom-I+1)}if($dim.html("<b>W</b>: "+(t.size.width+2*p-1)+"px, <b>H</b>: "+(t.size.height+2*p-1)+"px"),$(this).has(".textnew").length){var D=$(this).find(".textnew");t.size.height=D.height(),D.css("width",t.size.width)}},stop:function(e,t){if($guidesHV.hide(),computeGuides($(this)),$(this).data("resizing",!1),draggingInProgress=resizingInProgress=!1,$("#guide-v , #guide-h").hide(),$(this).addClass("selected"),computeGuides($(this)),$(this).data("resizing",!1),draggingInProgress=resizingInProgress=!1,$(".ui-resizable-resizing").hasClass("svginside")){var a=t.size.width;$(".ui-resizable-resizing svg ").css("width",a);var i=t.size.height;$(".ui-resizable-resizing svg ").css("height",i)}},snap:" .col ",handles:"all"}),e.each(function(){$(this).has(".textnew").length&&$(this).find(".ui-resizable-ne, .ui-resizable-nw, .ui-resizable-sw, .ui-resizable-se, .ui-resizable-n, .ui-resizable-s").remove()}),$(".grouped").length&&$(".grouped").resizable("destroy")}function MakeCanvasDrag(){$("#canvas-wrap").resizable({minWidth:320,minHeight:320,start:function(e,t){wirepanel.hide(),supercanvas.width("20000px");$("#canvas").height()},resize:function(e,t){cwidth=t.size.width,$(".canvassize").html("<b>canvas</b>: "+parseInt(t.size.width,10)+"/"+parseInt(t.size.height,10)+"px"),$("#canvas").css("width","100%"),$("#canvas").css("height","100%")},stop:function(e,t){draggingInProgress=resizingInProgress=!1,cwidth=t.size.width,$canvaswrap.hasClass("mobile-landscape")&&(cwidth=480),activepage.attr({"data-page-width":t.size.width,"data-page-height":t.size.height});var a;a=t.size.width+100<$(window).width()?$(window).width():t.size.width+450,supercanvas.css({width:a+"px",height:t.size.height+750+"px"}),t.size.height+750<$container.height()&&$container.scrollTop(t.size.height+750-$container.height()),t.size.height+450<$container.height()&&$container.scrollLeft(t.size.width+450-$container.widht()),$container.perfectScrollbar("update"),$(this).center(),updateCanvasInput()},handles:"s , e"}).draggable({handle:"#browser",cursor:"move",containment:".supercanvas",stop:function(e){parseInt($(this).css("top"),10)<32&&$(this).transition({top:"33px"}),offset_c=$("#canvas").offset()}}),$canvaswrap.find(".ui-resizable-se").addClass("icon-resize-full")}function delnow(){var e=$canvas.find(".selected").not(".locked");saveState(e),removeGuides(e),e.remove()}function positionwirepanel(e){offset_c=$("#canvas-wrap").position();var t=e||activepage.find("div.selected"),a=(t.height(),t.width()),i=t.position(),s=i.top,n=i.left,r=s+offset_c.top-45,o=wirepanel.width(),d=n+a/2-o/2+offset_c.left;0>=d&&(d=0),wirepanel.css({top:r,left:d}).show()}function editme(e,t){var a=e;if(a.is(".hastext")&&!a.find(".textme").is("[contenteditable=true]").length){if(!$canvas.hasClass("preview")&&!previewMode){t&&t.stopPropagation(),a.addClass("selected"),render_edit_menu(!0),positionwirepanel(a);var i=a.find(".textme");i.trigger("editThisText")}}else{if(a.is(".locked")||a.find(".textme").is("[contenteditable=true]"))return!1;a.length&&!a.is(".grouped")&&(render_edit_menu(),positionwirepanel())}}function copynow(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");e.addClass("copying").resizable("destroy").draggable("destroy");var t="",a=0,i=0;e.each(function(e){var s=$(this),n=s.position().top+s.height(),r=s.position().left+s.width();n>a&&(a=n),r>i&&(i=r),t+=s.outerHTML()});var s={data:t,filename:filename,parent:activepage.attr("id"),outerWidth:Math.round(i),outerHeight:Math.round(a)};localStorage.setItem("clipboard",JSON.stringify(s)),e.removeClass("selected , copying"),pasteIndex=1}function cutnow(){if(multipaged)var e=$("#canvas .page:visible .selected");else var e=$("#canvas .selected");copynow(),saveState(),e.remove()}function paste(){if(activepage.find("[contenteditable=true]").length)return!1;$canvas.find(".selected").removeClass("selected");var e=JSON.parse(localStorage.getItem("clipboard")),t=$("<div/>").html(e.data).contents(),a=[],i=1;activepage.find(".wirejr , .grouped").not(".aa, .groupmember").each(function(){var e=parseInt($(this).css("zIndex"),10);e>i&&(i=e)}),t.sort(function(e,t){return e=parseInt($(e).find(".wirejr").not(".groupmember").css("zIndex"),10),t=parseInt($(t).find(".wirejr").not(".groupmember").css("zIndex"),10),e-t});var s=activepage.attr("id")==e.parent&&filename==e.filename,n=parseInt(activepage.attr("data-page-height"),10)||$canvaswrap.height(),r=parseInt(activepage.attr("data-page-width"),10)||$canvaswrap.width();e.outerWidth>r&&(r=e.outerWidth),e.outerHeight>n&&(n=e.outerHeight),t.each(function(e){var t="w"+(new Date).getTime()+e;a[e]=t;var n=$(this),r={top:parseInt(n.css("top")),left:parseInt(n.css("left"))};n.attr("id",t).removeClass("copying"),n.is(".grouped")?n.css({"z-index":i+pasteIndex+e}):n.find(".wirejr").not(".groupmember .wirejr").css({"z-index":i+pasteIndex+e}),s&&n.css(gridsize>0?{top:Math.round((r.top+gridsize*pasteIndex)/gridsize)*gridsize+"px",left:Math.round((r.left+gridsize*pasteIndex)/gridsize)*gridsize+"px"}:{top:r.top+10*pasteIndex+"px",left:r.left+10*pasteIndex+"px"}),n.is(".grouped")&&$.each(n.find(".wire.groupmember"),function(e){var t="w"+(new Date).getTime()+e;$(this).attr("id",t)})}),activepage.append(t),computeGuides(t),makeDrag(t),saveState("",a),pasteIndex+=1,changePageSize(r,n,!1)}function changeBorderWidth(e){if(saveState(),$(".selected").has(".wirejr").length)var t=activepage.find(".selected").not(".locked").find(".wirejr");else var t=$canvas.find(".selected").not(".locked");t.css("box-sizing","content-box");var a=parseInt(t.css("borderLeftWidth"),10),i=e,s=t.width()-2*parseInt(i,10)+2*a,n=t.height()-2*parseInt(i,10)+2*a;t.css({width:s+"px",height:n+"px","border-width":e}),t.css({width:s+"px",height:n+"px","border-width":i+"px"}),t.hasClass("svginside")&&$(".selected svg *").css("stroke-width",i),t.hasClass("hasSVG")&&($(".selected svg line").attr("stroke-width",i),$(".selected svg .line1").attr({y1:n,x2:s}),$(".selected svg .line2").attr({y2:n,x2:s}),$(".selected svg").attr({height:n,width:s})),$dim.html("<b>W</b>: "+(t.outerWidth()-1)+"px, <b>H</b>: "+(t.outerWidth()-1)+"px")}function changeBackgroundColor(e){saveState();var t=e;if(activepage.find(".selected").has(".wirejr").length)var a=activepage.find(".selected").not(".locked").find(".wirejr");else var a=$canvas.find(".selected").not(".locked");a&&(a.css("background-color",t),a.hasClass("headline")&&a.find("span").css("background-color",t),activepage.find("[contenteditable=true]").length&&activepage.find("[contenteditable=true]").parent().css("color",t).end().focus(),a.find(".textme").length&&a.css("color",t).focus(),a.hasClass("paragraph")&&a.find("span").css("background-color",t),a.hasClass("list")&&(a.find("span").css({"background-color":t,color:t}),a.attr("data-color",t))),a.hasClass("svginside")&&$(".selected .image *").css("background-color",t)}function changeBorderColor(e){if(saveState(),$(".selected").has(".wirejr").length)var t=activepage.find(".selected").not(".locked").find(".wirejr");else var t=$canvas.find(".selected").not(".locked");current_brcolor=e,t.css("border-color",current_brcolor),t.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor),t.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor)}function bring_to_front(){var e=activepage.find(".selected").not(".locked");saveState(e),activepage.find(".wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10);e>index_highest&&(index_highest=e)}),e.each(function(){if($(this).is(".grouped"))var e=$(this);else var e=$(this).find(".wirejr");e.css("z-index",index_highest+1)})}function send_to_back(){var e=activepage.find(".selected").not(".locked");saveState(e),activepage.find(".wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10);$(this).css("z-index",e+1)}),e.each(function(){if($(this).is(".grouped"))var e=$(this);else var e=$(this).find(".wirejr");e.css("z-index",1)})}function send_backward(){var e=activepage.find(".selected").not(".locked");saveState(e),e.each(function(){if($(this).is(".grouped"))var e=$(this);else var e=$(this).find(".wirejr");var t=parseInt(e.css("zIndex"),10);t=0>=t?1:t,e.css("z-index",t-1)})}function bring_forward(){var e=activepage.find(".selected").not(".locked");saveState(e),e.each(function(){if($(this).is(".grouped"))var e=$(this);else var e=$(this).find(".wirejr");var t=parseInt(e.css("zIndex"),10);e.css("z-index",t+1)})}function computeGuidesForElement(e){var t=$(e);if(t.is(".col")){var a=t.position();ww=$("#canvas").width(),a.left+=.01*ww}else var a=t.position();if(t.is(".col"))var i=t.width(),s=t.height()-1;else var i=t.outerWidth()-1,s=t.outerHeight()-1;return[{type:"h",x:Math.round(a.left),y:Math.round(a.top)},{type:"h",x:Math.round(a.left),y:Math.round(a.top)+s},{type:"v",x:Math.round(a.left),y:Math.round(a.top)},{type:"v",x:Math.round(a.left)+i,y:Math.round(a.top)}]}function computeColForElement(e){var t=$(e),a=t.position();ww=$canvas.width(),a.left+=.01*ww;var i=t.width();return[Math.round(a.left+1),Math.round(a.left+i)]}function aspect_ratio(e){var t=e.width(),a=e.height(),i=t/a;i>=.3&&4>=i&&($(".icon.rect").show(),$(".icon:not(.rect)").hide()),.3>i&&($(".icon.vertical").show(),$(".icon:not(.vertical)").hide()),i>4&&($(".icon.horizontal").show(),$(".icon:not(.horizontal)").hide()),$("#annotate").hide(),$("#textinput").addClass("lasticon")}function render_edit_menu(e){$("#icons").hide().siblings().not("#lock , #unlock , #linklist").show(),$("#linklist").hide();var t=activepage.find(".selected");if(t.has(".wirejr").length)var a=t.find(".wirejr");else var a=t;$showbg.hide(),a.hasClass("paragraph")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.show(),$edittxt.hide()),a.hasClass("list")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$("#textsize").show(),$("#textalign").hide(),$edittxt.hide()),e||a.hasClass("paragraph")||a.hasClass("list")||($("#show-border").show(),$("#brind-back-front").show(),$colorpickers.show(),$bordercolors.hide(),$strokes.show(),$textalsz.hide()),(e||a.hasClass("headlinetxt")||a.hasClass("headline"))&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.show())}function getRandomNumber(e){return Math.floor(Math.random()*e);

}function getRandomChar(){var e="0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ";return e.substr(getRandomNumber(62),1)}function randomID(e){for(var t="",a=0;e>a;a++)t+=getRandomChar();return t}function demo0(){$("#canvas").append("<div id='demo'><div class='demoinfo'>Click & drag to draw</div><div id='demobox' ></div><div id='democursor'><i class='icon-cursor'></i></div><div id='demopanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div id='demoeditpanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>"),$("#demobox").css({width:"0",height:"0"}).removeAttr("class"),$(".demoinfo").text("Click & drag to draw"),$("#demo").fadeIn("slow",demo1)}function demo1(){$("#democursor").animate({top:"40px",left:"20px"},1500,demo1a)}function demo1a(){$("#democursor").addClass("drag"),demo2()}function demo2(){$("#demobox").delay(500).animate({width:"240px",height:"160px"},3500),$("#democursor").delay(500).animate({top:"200px",left:"260px"},3500,demo3)}function demo3(){$("#democursor").removeClass("drag"),$("#demopanel").delay(500).show(0,demo4)}function demo4(){$(".demoinfo").text("Select stencil"),$("#democursor").delay(800).animate({top:"125px",left:"55px"},1500,demo5)}function demo4a(){demo5()}function demo5(){$("#demobox").addClass("demobox"),$("#democursor").delay(800).animate({top:"125px",left:"80px"},500,demo5a)}function demo5a(){$("#demobox").addClass("round"),$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5b)}function demo5b(){$("#demobox").addClass("demoround"),$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5c)}function demo5c(){$("#democursor").addClass("drag"),demo5d()}function demo5d(){$("#demopanel").delay(300).hide(0,demo5e)}function demo5e(){$("#democursor").removeClass("drag"),demo6()}function demo6(){$("#demopanel").delay(1500).hide(0,demo6a)}function demo6a(){$(".demoinfo").text("Doubleclick to edit"),$("#democursor").addClass("drag"),$("#demopanel").delay(200).hide(0,demo6b)}function demo6b(){$("#democursor").removeClass("drag"),demo6c()}function demo6c(){$("#demopanel").delay(200).hide(0,demo6d)}function demo6d(){$("#democursor").addClass("drag"),$("#demopanel").delay(200).hide(0,demo6e)}function demo6e(){$("#democursor").removeClass("drag"),$("#demoeditpanel").delay(400).show(0,demo7)}function demo7(){$("#democursor").delay(800).animate({top:"125px",left:"178px"},500,demo7a)}function demo7a(){$("#demopanel").delay(500).hide(0,demo7b)}function demo7b(){$("#democursor").addClass("drag"),$("#demobox").addClass("grey"),demo7c()}function demo7c(){$("#demoeditpanel").delay(300).hide(0,demo7d)}function demo7d(){$("#democursor").removeClass("drag"),demo8()}function demo8(){$("#demo").delay(1600).hide("slow")}function updategrid(e){$("#gridcol").hide();for(var t=0;5>t;t++){var a="#grid-pattern .lineV:eq("+[t]+")",i="#grid-pattern .lineH:eq("+[t]+")";$(i).attr({y1:[t+1]*e,y2:[t+1]*e,x2:5*e}),$(a).attr({x1:[t+1]*e,x2:[t+1]*e,y2:5*e}),$(".svgdot").attr({cx:e-.5,cy:e-.5})}$("#grid-pattern").attr({width:5*e,height:5*e}),$("#dot-pattern").attr({width:e,height:e})}function turngridon(){$("#snap-to-grid").attr("checked")&&("graph"==$("select#grid-type").val()?(gridsize=$("#grid-slider").slider("value"),$canvaswrap.attr({"data-grid-size":gridsize,"data-grid-show":"true"})):"dots"==$("select#grid-type").val()&&(gridsize=$("#grid-slider").slider("value"),$canvaswrap.attr({"data-grid-size":gridsize,"data-grid-show":"true"})))}function getDeletedGroupData(e){var t=[];return $.each(e,function(e){var a=$(this);t[e]={html:a.find("div").first().outerHTML(),css:{top:a.css("top"),left:a.css("left"),width:a.css("width"),height:a.css("height")},id:a.attr("id"),orgclass:a.attr("class"),parent:a.parent().attr("id")}}),t}function saveState(e,t,a,i,s){var n=[];if("undefined"==typeof e)var e=$canvas.find(".selected");if(t?n={deleteid:t}:$.each(e,function(e){var t=$(this),a=t.getId();n[e]={html:t.find("div").first().outerHTML(),css:{top:t.css("top"),left:t.css("left"),width:t.css("width"),height:t.css("height"),"z-index":t.css("zIndex")},id:a,orgclass:t.attr("class"),parent:t.parent().attr("id"),unlock:t.hasClass("locked")}}),s)for(var r in s)n[r]=s[r];var o;a?o=future:(o=historystate,i||(future=[],$("#redo").removeClass("inactive"))),o.unshift(n),o.length>10&&o.pop(),$("#undo").hasClass("inactive")&&$("#undo").removeClass("inactive")}function restoreState(e){var t;if(t=e?historystate:future,t.length>0){var a=t[0],i=$();if(a.deleteid&&deletePasted(a,e),a.hasOwnProperty("0")){delete a.deleteid,$.each(a,function(e){i=i.add($("#"+a[e].id))}),$("#"+a[0].id).length&&saveState(i,!1,e,!0);var s=!1,n=[];$.each(a,function(e){if(a[e].unlock)return void unlock($("#"+a[e].id));var t=$("#"+a[e].id);if(t.length&&!t.is(".groupmember"))t.resizable("destroy").draggable("destroy").css(a[e].css).html(a[e].html).find("[contenteditable").attr("contenteditable",!1),computeGuides(t);else{$("<div/>").appendTo($("#"+a[e].parent)).addClass(a[e].orgclass).removeClass("ui-draggable ui-resizable ui-resizable-autohide").html(a[e].html).attr("id",a[e].id).css(a[e].css).find("[contenteditable").attr("contenteditable",!1);var r=$("#"+a[e].id);i=i.add($("#"+a[e].id)),n[e]=a[e].id,computeGuides(r),s=!0}}),s&&saveState("",n,e,!0),makeDrag(i)}t.shift(),$("#redo").hasClass("inactive")&&$("#redo").removeClass("inactive"),e||t.length||($("#redo").addClass("inactive"),$("#undo").removeClass("inactive")),e&&!t.length&&$("#undo").addClass("inactive")}else $("#undo").addClass("inactive");computeGuides()}function deletePasted(e,t){var a=$();$.each(e.deleteid,function(e){$("#"+this).is(".grouped")?ungroup_elements($("#"+this)):a=a.add($("#"+this))}),saveState(a,!1,t),removeGuides(a),a.remove()}function makeDragNow(){historystate.shift(),activepage=$(multipaged?".page:visible":"#canvas"),useboxer(),$("#canvas").mousemove(function(e){$(".coord").html("<b>X</b>: "+parseInt(e.pageX-offset_c.left,10)+" <b>Y</b>: "+parseInt(e.pageY-offset_c.top,10))})}function saveUndo(){future.length>4&&future.pop()}function handleKeys(e){if(!$ajaxlogin.is(":visible")&&!activepage.find("textarea.editingtext").length)switch($canvas.find(".locked.selected").removeClass("selected"),draggable=$canvas.find(".selected"),distance=1,gridsize>0&&(distance=parseInt(gridsize,10)),pTopArray=[],pLeftArray=[],37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode||e.ctrlKey||(saveState(),draggable.each(function(e){thiscsstop=$(this).css("top"),thiscssleft=$(this).css("left"),pTopArray[e]=parseInt(thiscsstop,10),pLeftArray[e]=parseInt(thiscssleft,10)})),e.preventDefault(),e.keyCode){case 37:draggable.each(function(e){$(this).css("left",pLeftArray[e]-distance)});break;case 38:draggable.each(function(e){$(this).css("top",pTopArray[e]-distance)});break;case 39:draggable.each(function(e){$(this).css("left",pLeftArray[e]+distance)});break;case 40:draggable.each(function(e){$(this).css("top",pTopArray[e]+distance)});break;default:return!0}computeGuides(draggable)}function group_ungroup(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");1===e.length&&e.is(".grouped")?ungroup_elements(e):group_elements(e)}function group_elements(e){if(e.length>1){var t=1e4,a=1e4,i=-1,s=-1;removeGuides(e),e.each(function(){var e=$(this).position(),n=$(this).width(),r=$(this).height();t=t<e.top?t:e.top,a=a<e.left?a:e.left,i=i>e.left+n?i:e.left+n,s=s>e.top+r?s:e.top+r}),activepage.find("> .wire > .wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10)||0;index_highest=1|index_highest,e>index_highest&&(index_highest=e)});var n=Math.floor(99999*Math.random());e.draggable("destroy").resizable("destroy").css({position:"absolute"}).removeClass("selected").addClass("groupmember"),e.wrapAll('<div  style="position:relative; top:-'+t+"px; left:-"+a+'px;"/>'),e.parent().wrap('<div class="grouped wire" id='+n+' style="position:absolute;top:'+t+"px; left:"+a+"px;width:"+(i-a)+"px;height:"+(s-t)+"px;z-index:"+(index_highest+1)+'"/>'),e.parent().parent().addClass("selected"),computeGuides(activepage.find(".selected")),saveState("",[n]),$("#group").addClass("pressed")}}function ungroup_elements(e){e.draggable("destroy").resizable("destroy");var t=[],a=[];t=getDeletedGroupData(e),e.each(function(e){var t=$(this),i=t.find("> div > .wire").clone();i=i.sort(function(e,t){if($(e).is(".grouped"))var a=parseInt($(e).css("zIndex"));else var a=parseInt($(e).find(".wirejr").css("zIndex"));if($(t).is(".grouped"))var i=parseInt($(t).css("zIndex"));else var i=parseInt($(t).find(".wirejr").css("zIndex"));return a-i});var s=t.position(),n=parseInt(t.css("zIndex")),r=t.find("> div").position(),o=[];i.each(function(e){var t=$(this);t.is(".grouped")?t.css("z-index",n):t.find(".wirejr").css("z-index",n),o[e]=t.attr("id"),abspos={top:parseInt(t.css("top")),left:parseInt(t.css("left"))},t.css({top:s.top+(abspos.top+r.top),left:s.left+(abspos.left+r.left)})}),a=a.concat(o),i.removeClass("groupmember").appendTo(activepage),computeGuides(i),$("#group").removeClass("pressed"),t.remove()}),saveState("",a,null,null,t)}function sortdivs(e,t){for(var a=new Array,i=0;i<e.length;i++)pos=e.eq(i).position(),a.push("top"==t?{div:e.eq(i),val:pos.top}:{div:e.eq(i),val:pos.left});var s=a.sort(function(e,t){return e.val<t.val?-1:e.val>t.val?1:0});return s}function renderContextMenu(){$("#canvas").contextPopup({title:"",items:[{label:"Copy",action:function(){copynow()},"short":"Ctrl+C"},{label:"Cut",action:function(){cutnow()},"short":"Ctrl+X"},{label:"Paste",action:function(){paste()},"short":"Ctrl+V"},{label:"Delete",action:function(){delnow()},"short":"Del"},{label:"Edit",action:function(){$(".selected").dblclick()},"short":"doubleclick"},{label:"Bring to front",action:function(){bring_to_front()},"short":"Ctrl+Shift+↑"},{label:"Bring forward",action:function(){bring_forward()},"short":"Ctrl+↑"},{label:"Send to back",action:function(){send_to_back()},"short":"Ctrl+Shift+↓"},{label:"Send backward",action:function(){send_backward()},"short":"Ctrl+↓"},{label:"Lock / Unlock",action:function(){lock()},"short":"Ctrl+L"},{label:"Group / Ungroup",action:function(){group_ungroup()},"short":"Ctrl+G"},{label:"Link",action:function(){makeLink()},"short":"Ctrl+K"}]})}function add_new_page(){apprise("Enter new name",{verify:!0,input:!0},function(e){if(!e)return!1;e=escapeHtml(e);var t=$.now(),a=activepage.data("template");$("#canvas").append($("<div>").addClass("page").attr({id:t,"data-pagename":e,"data-page-height":$canvaswrap.height(),"data-page-width":$canvaswrap.width(),"data-template":a,"data-hidden":"false"})),pagelist.append($("<li>").attr({"data-pageid":t,"data-hidden":"false"}).addClass("dd-item").append($("<div/>").text(e).addClass("dd-handle").attr("title",e)).append("<span class='hidepage tooltip-smp' data-hint></span>")),make_page_active(t),$(".pagename-wrap").click()})}function make_page_active(e,t){removeGuides(activepage.find(" > .wire"));var a=$("[data-pageid="+e+"]"),i=a.find(".dd-handle").first().text();$canvas.find(".selected").removeClass("selected"),$(".pagename").text(i).attr({"data-hidden":a.data("hidden"),title:i}),activepage.hide();var s=activepage.data("template");activepage=$("#"+e),activepage.show().siblings(".page").hide(),$(".sitemap li").removeClass("activepage"),a.addClass("activepage"),wirepanel.hide();var n=activepage.attr("data-page-width")||$canvaswrap.width(),r=activepage.attr("data-page-height")||$canvaswrap.height(),o=activepage.attr("data-template");s!==o&&$("[data-template-btn="+o+"]").insertBefore($("[data-template-btn]:first")),$canvaswrap.css({width:n+"px",height:r+"px"}).removeClass("mobile template browser-wrap mobile-landscape").addClass(o);var n=parseInt($canvaswrap.width(),10)+250;n<$(window).width()&&(n=$(window).width()),supercanvas.css({width:n+"px",height:parseInt(r,10)+750+"px"}),cwidth=n,$("#canvas").show(),updateCanvasInput(n,r),$canvaswrap.center(),previewMode?(0==$("#"+activepage.attr("id")+" ~ .page:not([data-hidden=true])").length?$("#next").addClass("inactive"):$("#next").removeClass("inactive"),0==activepage.prevAll(".page:not([data-hidden=true])").length?$("#prev").addClass("inactive"):$("#prev").removeClass("inactive")):(computeGuides(activepage.find(" > .wire")),computeGuides("canvas"),useboxer()),$container.scrollTop(0).perfectScrollbar("update")}function makeLink(){if($(".page").length){var e=$("#linkselect");e.empty(),e.append($("<option>").append("None").attr("value",0)),$(".sitemap ol li").each(function(){e.append($("<option>").append($(this).text()).attr("value",$(this).attr("data-pageid")))});var t=$("#canvas .page:visible .selected").attr("data-link");t&&$("#linkselect option[value="+t+"]").attr("selected",!0),$("#linklist").show().siblings().hide(),positionwirepanel(),wirepanel.show(),e.change(function(){var e=$("#linkselect option:selected").attr("value");$("#canvas .page:visible .selected").attr("data-link",e).addClass("icon-link"),wirepanel.hide()})}else alert("You need to be a Premium user to make clickable wireframes.")}function preview(){previewMode=!previewMode,previewMode&&(activepage.find(".selected").removeClass("selected"),$("#top").addClass("topup"),$container.removeClass("slide-left , slide-right , slide-down"),exportbtn.removeClass("pressed"),$(".bottomright, #wirepanel").hide(),$("#canvas .page .wire").draggable("destroy").resizable("destroy").removeClass("ui-resizable-autohide"),$("#canvas").addClass("preview"),$(".ui-boxer").boxer("destroy"),$("#canvas .page").bind("click",highlightclickable),$("#canvas .page .wire[data-link]").bind("click",gotopage))}function highlightclickable(){var e=$("#canvas .page:visible .wire[data-link]");e.stop(!0,!0).addClass("hilite").delay(600).queue(function(t){e.removeClass("hilite")})}function makeEditable(){$("#top").removeClass("topup"),$(".bottomright").show(),$("#canvas").removeClass("preview"),$(".wire[data-link]").unbind("click",gotopage),$("#canvas .page").unbind("click",highlightclickable),useboxer()}function saveComment(){$savecomment.show(),$savecomment.bind("click",function(){$("#canvas .page .publiccomment ,#canvas .page .aa").resizable("destroy").draggable("destroy");var e="";$("#canvas .page .publiccomment , #canvas .page .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),e+=$(this).outerHTML()});var t=encodeURIComponent(e);$.post("../savecomment",{pblcaa:t,preview:previewid},function(){$(".saved").show().delay(600).fadeOut(),$("#canvas .page .publiccomment").draggable({stop:function(){saveComment()}}).resizable({handles:"all",stop:function(){saveComment()}}),$savecomment.unbind("click"),$savecomment.hide()})})}function positionAA(){$(".publiccomment , .aa").each(function(){$(this).appendTo($("#"+$(this).attr("data-parent")))}),$(".publiccomment").draggable({stop:function(){saveComment()}}).resizable({handles:"all",stop:function(){saveComment()}})}function getMaxDim(){var e=$canvas.find(".page"),t=e.map(function(){return $(this).attr("data-page-width")}).get(),a=e.map(function(){return $(this).attr("data-page-height")}).get();return{width:Math.max.apply(Math,t),height:Math.max.apply(Math,a)}}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function demoStart(){fc.addClass("no-cursor"),c.show().transition({x:"0",y:"0"},0).transition({x:"-130px",y:"-68px"},1600).transition({x:"-130px",y:"-60px",easing:"snap",delay:200},150,demo1)}function demo1(){c.hide(),d1.addClass("draw").removeClass("bg-grey demo-box").css({width:0,height:0}).transition({width:"0",height:"0"},0).show().find(".cursor").show().end().transition({width:"260px",height:"160px",delay:100},2500,demo2)}function demo2(){d1.find(".cursor").hide(),wp.css({top:"-45px",left:"0px"}).show().find(".draw-icons").show().end().find(".edit-icons").hide(),c.show().transition({x:"128px",y:"98px"},0,demo3)}function demo3(){c.transition({x:"-120px",y:"-95px",delay:"600"},1600,demo4)}function demo4(){d1.removeClass("draw").addClass("demo-box"),c.transition({x:"-120px",y:"-91px"},100).transition({x:"-120px",y:"-95px"},100,demo5)}function demo5(){wp.hide(),c.transition({x:"-42px",y:"-35px",delay:"400"},1e3).transition({x:"-42px",y:"-30px"},100).transition({x:"-42px",y:"-35px"},150).transition({x:"-42px",y:"-30px"},100).transition({x:"-42px",y:"-35px"},150,demo6)}function demo6(){wp.show().find(".draw-icons").hide().end().find(".edit-icons").show(),c.transition({x:"75px",y:"-95px"},1100).transition({x:"75px",y:"-90px"},100).transition({x:"75px",y:"-95px"},100,demo7)}function demo7(){d1.addClass("bg-grey"),window.setTimeout(demo8,800)}function demo8(){wp.hide(),fc.removeClass("no-cursor"),d1.hide(),dw.hide(),$("#feux-play").show()}function movePage(e,t){var a=$canvas.find("#"+e.data("pageid"));if($.each(e.find(".dd-item"),function(){a=a.add($canvas.find("#"+$(this).data("pageid")))}),t=t||-1,-1===t){if($canvas.find(".page").first().is("#"+e.data("pageid")))return;$canvas.find(".page").first().before(a)}else $canvas.find("#"+t).after(a)}function setLiParent(e,t){$canvas.find("#"+e).attr("data-parent-id",t)}function hideGuidesAndMarkers(){$guidesHV.removeClass("visible"),$canvas.data({guideH:!1,guideV:!1}),activepage.find("[data-snap-mark-h]").removeAttr("data-snap-mark-h"),activepage.find("[data-snap-mark-v]").removeAttr("data-snap-mark-v")}function snapGuides(e,t){if(appSettings.snapToGuides&&appSettings.drawSnap){if(activepage.find(".ui-resizable-handle:hover").length&&!resizingInProgress)return $guidesHV.hide(),$canvas.data({guideH:!1,guideV:!1}),!1;if($canvas.find(".wire:hover").length&&!$canvas.data("drawing-in-progress")&&!resizingInProgress&&!t.shiftKey)return $guidesHV.hide(),$canvas.data({guideH:!1,guideV:!1}),!1;var a,i,s,n,r,o,d=4,c=4,l=wireDistV=1e3;for(var p in guides){i=guides[p].edges,o=p;var h=Math.min(Math.abs(e.y-i.top),Math.abs(e.y-i.bottom)),g=Math.min(Math.abs(e.x-i.left),Math.abs(e.x-i.right));guides.hasOwnProperty(p)&&$.each(guides[p].g,function(t,i){Math.abs(i.y-e.y)<c&&l>g&&(s=this,n=o,l=g),Math.abs(i.x-e.x)<d&&h<wireDistV&&(a=this,r=o,wireDistV=h)})}s?($guideH.addClass("visible").show().css("transform","translateY("+s.y+"px)"),$canvas.data("guideH",s),activepage.find("[data-snap-mark-h]").removeAttr("data-snap-mark-h"),markAadjacentElement(s,n)):($canvas.data("guideH",!1),$guideH.removeClass("visible"),activepage.find("[data-snap-mark-h]").removeAttr("data-snap-mark-h")),a?($guideV.addClass("visible").show().css("transform","translateX("+a.x+"px)"),$canvas.data("guideV",a),activepage.find("[data-snap-mark-v]").removeAttr("data-snap-mark-v"),markAadjacentElement(a,r)):($canvas.data("guideV",!1),$guideV.removeClass("visible"),activepage.find("[data-snap-mark-v]").removeAttr("data-snap-mark-v"))}}function markAadjacentElement(e,t){$("#"+t).attr("data-snap-mark-"+e.type.slice(0,1),e.pos)}function removeGuides(e){var t=$(e);return t.length?void t.each(function(e,a){delete guides[$(a).attr("id")],t.is(".grouped")&&t.find(".groupmember").each(function(){delete guides[$(this).attr("id")]})}):!1}function roundHalf(e){return parseFloat((Math.round(2*e)/2).toFixed(1))}function computeGuides(e){if(e&&"col"!==e)var t=$(e);else if("col"===e)var t=$canvas.find(".col");else var t=activepage.find(" > .wire").add($canvas);var a;$.each(t,function(e,i){var s=$(i).position();if($(i).is(".col")&&$(i).is(":visible")){{var n=t.outerWidth(),r=t.outerHeight();$canvas.width()}l=[{type:"v",x:s.left+parseInt(t.css("marginLeft"),10)+1,pos:"w",parent:"col"},{type:"v",x:s.left+parseInt(t.css("marginLeft"),10)+1+n,pos:"e",parent:"col"}],a=$(i).attr("id");var o={top:s.top,left:s.left+parseInt(t.css("marginLeft"),10)+1,bottom:s.top+r,right:s.left+parseInt(t.css("marginLeft"),10)+1+n}}else if($(i).is("#canvas")){var n=$(i).outerWidth()-1,r=$(i).outerHeight()-1;l=[{type:"h",y:0,pos:"n"},{type:"h",y:r,pos:"s"},{type:"v",x:0,pos:"w"},{type:"v",x:n,pos:"e"}],a="Canvas";var o={top:s.top,left:s.left,bottom:s.top+r,right:s.left+n}}else{var d=$(i);if(d.hasClass("grouped"))return void computeGuides(d.find(".groupmember"));if(!isScrolledIntoView(d))return void removeGuides(d);if(d.parent().is("#selection-wrap"))var c={left:$selectionWrap.position().left/zoomfactor,top:$selectionWrap.position().top/zoomfactor};else var c={top:0,left:0};s=d.hasClass("groupmember")?{top:roundHalf(d.parents(".grouped").first().position().top+d.position().top- -d.parent().position().top),left:roundHalf(d.parents(".grouped").first().position().left+d.position().left- -d.parent().position().left)}:{top:roundHalf(d.position().top+c.top),left:roundHalf(d.position().left+c.left)};var n=roundHalf(d.outerWidth()-1),r=roundHalf(d.outerHeight()-1);$(i).is(".hastext")&&(n=roundHalf($(i).find(".textme").outerWidth()-1),r=roundHalf($(i).find(".textme").outerHeight()-1)),$(i).is(".hastext")&&!$(i).is(".text20")&&($(i).width(Math.round($(i).find(".textme").outerWidth())),$(i).height(Math.round($(i).find(".textme").outerHeight())));var l=[{type:"h",y:s.top,pos:"n"},{type:"v",x:s.left,pos:"w"},{type:"hm",y:Math.round(s.top+(r+1)/2),pos:"c"},{type:"h",y:s.top+r,pos:"s"},{type:"v",x:s.left+n,pos:"e"},{type:"vm",x:Math.round(s.left+(n+1)/2),pos:"c"}];a=d.attr("id");var o={top:s.top,left:s.left,bottom:s.top+r,right:s.left+n}}a&&(guides[a]={g:l,edges:o})})}function isScrolledIntoView(e){var t=$(window).scrollTop()+45,a=t+$(window).height(),i=$(e).offset().top,s=i+$(e).height();return s>=t&&a>=s||a>=i&&i>=t}function changePageSize(e,t,a){e&&(supercanvas.width(e+300),a||($canvaswrap.width(e),activepage.attr("data-page-width",e)),$container.scrollLeft(0).perfectScrollbar("update")),t&&(supercanvas.height(t+300),a||($canvaswrap.css("height",t+"px"),activepage.attr("data-page-height",t)),$container.scrollTop(0).perfectScrollbar("update")),a||updateCanvasInput(e,t)}function hidePageFromPreview(e,t){var a=e instanceof jQuery;if(a||(e=$(e)),void 0==t)var t=e.data("hidden")||!1;else var t=t;if($("#"+e.attr("data-pageid")).add(e).attr("data-hidden",!t),e.is(".dd-parent")){var i=t?"expand":"collapse";e.find("  button[data-action="+i+"]").click(),e.find("li").each(function(e,a){hidePageFromPreview(a,t)})}}function populateLoremText(){supercanvas.find(".text-lorem [data-lorem-count]").each(function(e,t){var a=$(t).data("lorem-count");$(t).find(".textme").length?$(t).find(".textme").text(paragraphArr.slice(0,a+1).join(" ")):$(t).append("<div>").find("div").addClass("textme").text(paragraphArr.slice(0,a+1).join(" "))})}$(function(){$canvas.offset();if($(".editable").editnibble("hideAllEditors"),$("#show-bg").hide(),$("#canvas .txtcont span:empty").length&&$(".txtcont span:empty").text(paragraphtext),$("#canvas .listcont:empty").length){var e=$(".listcont:empty");e.each(function(){var e=$(this).parent().attr("data-color");$(this).html(list).find("li span").css({"background-color":e})})}imgs=$(".device-wrap span"),$("#canvas .wire").not(".grouped").has(".headlinetxt").addClass("hastext"),activepage.find(".wire").not(".groupmember").each(function(e,t){$(t).attr("id")||($(t).attr("id","w"+(new Date).getTime()),computeGuides($(t)))}),multipaged||computeGuides(activepage.find(" > .wire")),$(".textnew.ui-draggable").draggable("destroy"),$canvaswrap.center(),$("#canvas .locked").draggable("destroy").resizable("destroy")}),$("#canvas .wire").not("#canvas .wire:has(.wirejr)").css({"border-style":"solid"});var multipaged;multipaged=$("#canvas .page").length?!0:!1;var $container=$(".container"),supercanvas=$(".supercanvas"),exporting=$(".exporting"),gridsize=0,imgs,wirePresent=!0,wirepanel=$("#wirepanel"),$canvaswrap=$("#canvas-wrap"),annotPresent=!0,offset_c=$("#canvas").offset(),cwidth=$("#canvas-wrap").width(),MIN_DISTANCE=7,guides=[],$showgrid=$("#show-grid"),$snaptogrid=$("#snap-to-grid"),$snaptoguides=$("#snap-to-guides"),$drawsnap=$("#draw-snap"),$transformsnap=$("#transform-snap"),$guideH=$("#guide-h"),$guideV=$("#guide-v"),$guidesHV=$("#guide-v , #guide-h"),$selectgridtype=$("select#grid-type"),resizingInProgress,$options=$(".options"),innerOffsetX,innerOffsetY,$statsCoord=$(".stats-coord"),$statsDim=$(".stats-dim"),offseta1=$("#canvas").offset(),defbw=1,defstrcolor="#444",defbgcolor="white",clonewidth=0,cloneheight=0,$canvas=$("#canvas"),index_highest=0,sttngs=$(".settings span i"),sett=$(".settings"),$sitemapicon=$("#sitemap icon i"),previewMode,$dim=$(".dim"),$edittxt=$("#edittxt");$container.hasClass("preview")&&(previewMode=!0);var appSettings={fixedToolbar:!0,snapOnDraw:!0,snapTo:1,snapToGuides:!0,transformSnap:!0,drawSnap:!0,snapToGrid:!1,snapToCol:!1,gridSize:20,gridType:"grid"};$(document).ready(function(){previewMode||setgrid(),updateCanvasInput(),previewMode||$(".aa").draggable().resizable({handles:"all"})}),positionAA(),$("#show-grid").bind("change",function(){$(this).is(":checked")?($("#show-columns").removeAttr("checked"),$("#gridcol").hide(),removeGuides(".col"),$canvaswrap.attr({"data-col":"false","data-grid-show":"true"}),"graph"==$("select#grid-type").val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$canvaswrap.attr("data-grid-type","graph")):"dots"==$("select#grid-type").val()&&($("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$canvaswrap.attr("data-grid-type","dots"))):($("#grid-div , #grid-dot").hide(),$canvaswrap.attr("data-grid-show","false"))}),$("#show-columns").bind("change",function(){$(this).is(":checked")?($("#show-grid").removeAttr("checked"),$("#gridcol").show(),$canvaswrap.attr({"data-col":"true","data-grid-type":"false","data-grid-show":"false"}),$("#grid-div , #grid-dot").hide(),computeGuides("col")):($("#gridcol").hide(),$canvaswrap.attr("data-col","false"),removeGuides(".col"))}),$("#gridcol").is(":visible")||$("#grid-div").is(":visible")||$("#show-grid").removeAttr("checked"),$("select#grid-type").change(function(){"graph"==$("select#grid-type").val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid-type","graph"),appSettings.snapToCol=!1,removeGuides(".col")):"dots"==$("select#grid-type").val()&&($("#grid-dot").show(),$("#gridcol, #grid-div").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid-type","dots"),appSettings.snapToCol=!1,removeGuides(".col"))}),$("#empty").click(function(){var e=confirm("Do you want to clear the canvas?");e===!0&&(window.location="/")});var imgs=$(".device-wrap span");$(".device-mobile").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.addClass("mobile").removeClass("browser-wrap , mobile-landscape , tablet").center(),activepage.find(".wire").length||($canvaswrap.css({width:"320px",height:"480px"}).center(),activepage.attr({"data-page-width":"320","data-page-height":"480"})),activepage.attr("data-template","mobile"),offset_c=$("#canvas").offset(),updateCanvasInput(),imgs=$(".device-wrap span"))}),$(".device-tablet").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.addClass("mobile , tablet").removeClass("browser-wrap , mobile-landscape").center(),activepage.find(".wire").length||($canvaswrap.css({width:"728px",height:"1024px"}).center(),activepage.attr({"data-page-width":"728","data-page-height":"1024"}),supercanvas.css("height","1350px")),activepage.attr("data-template","mobile tablet"),$(".container").css("overflow-y","auto"),offset_c=$("#canvas").offset(),imgs=$(".device-wrap span"),updateCanvasInput())}),$(".device-window").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.removeClass("mobile , tablet , mobile-landscape").addClass("browser-wrap").center(),activepage.find(".wire").length||($canvaswrap.css({width:"820px",height:"480px"}).center(),activepage.attr({"data-page-width":"820","data-page-height":"480"})),activepage.attr("data-template","browser-wrap"),offset_c=$("#canvas").offset(),updateCanvasInput(),imgs=$(".device-wrap span"))}),$(".device-mobile-landscp").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),activepage.attr("data-template","mobile-landscape"),$canvaswrap.addClass("mobile-landscape").removeClass("browser-wrap , mobile , tablet").center(),activepage.is(":empty")&&($canvaswrap.css({width:"480px",height:"320px"}).center(),activepage.attr({"data-page-width":"480","data-page-height":"320"})),offset_c=$("#canvas").offset(),updateCanvasInput(),imgs=$(".device-wrap span"))}),$("#show-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").show(),$("#hide-annotation").show(),$(this).hide()}),$("#hide-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").hide(),$("#show-annotation").show(),$(this).hide()}),$("#edit-wire").click(function(){$("#canvas .selected").dblclick()}),$("#lock").click(function(){lock()});var $ajaxlogin=$("#ajaxlogin"),supports_pushState="pushState"in history;$("#save").click(function(){activepage.find(".selected").removeClass("selected").end().find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v").end().find("[contenteditable=true]").blur(),$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var e=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment, form , option , xmp , textarea , plaintext").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().find(".text-lorem [data-lorem-count] .textme").empty().end().htmlClean().html(),t=encodeURIComponent(e),a="";$("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),a+=$(this).outerHTML()});var i=encodeURIComponent(a);$.ajax({type:"POST",url:"../save",data:{note:t,name:filename,aa:i},success:function(s){switch(s){case"login":localStorage.setItem(filename,e),localStorage.setItem(filename+"aa",a),$ajaxlogin.find(".wrongpass").hide(),$ajaxlogin.show().submit(function(e){e.preventDefault(),$.ajax({type:"POST",url:"../ps/ajaxlogin.php",data:$ajaxlogin.serialize(),success:function(e){0==e?$ajaxlogin.find(".wrongpass").show():$.ajax({type:"POST",url:"../save",data:{note:t,name:filename,aa:i},success:function(){$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"}),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa"),$ajaxlogin.hide(),_paq.push(["trackGoal",3])}})}})}),_paq.push(["trackGoal",2]);break;default:$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"}),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa")}},error:function(){localStorage.setItem(filename,e),localStorage.setItem(filename+"aa",a),MakeCanvasDrag(),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"}),_paq.push(["trackGoal",1])}})}),$("#fork").click(function(){activepage.find(".selected").removeClass("selected").end().find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v").end().find("[contenteditable=true]").blur(),$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var e=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment , form , option , xmp , textarea , plaintext").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().find(".text-lorem [data-lorem-count] .textme").empty().end().htmlClean().html(),t=encodeURIComponent(e),a="";$("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),a+=$(this).outerHTML()});var i=encodeURIComponent(a),s=$.now();$.post("../fork",{
note:t,name:filename,aa:i,timestamp:s},function(){$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"})})}),$("#savefree").click(function(){var e=!0;$canvas.find(".selected").removeClass("selected").end().find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v").end().find("[contenteditable=true]").blur(),$("#canvas .wire , #canvas .aa ").draggable("destroy").resizable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var t=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot , form , option , xmp , textarea , plaintext").remove().end().find(".text-lorem [data-lorem-count] .textme").empty().end().htmlClean().html(),a=encodeURIComponent(t);0===filename?filename=randomID(6):e=!1,supports_pushState?history.pushState({},"filename","/"+filename):location.hash="#"+filename,$.post("save.php",{note:a,name:filename},function(){MakeCanvasDrag(),e?($(".savedURL").html("http://wireframe.cc/"+filename),$(".save-wrap").fadeIn().delay(1600).fadeOut()):$(".saved").fadeIn().delay(600).fadeOut(),makeDrag($("#canvas .aa"))})}),$(".closeannot , .closeURLpopup").click(function(){var e=$(this).parent();e.remove(),previewMode&&saveComment()});var mousedownHappened=!1;if($canvas.delegate(".wire [contenteditable=true]","blur",function(e){if(mousedownHappened)return mousedownHappened=!1,!1;wirepanel.hide(),unselectAll();var t=$(this).parents(".wire");""===$(this).text()?t.remove():($(this).attr("contenteditable",!1).html($(this).html()),t.css({"z-index":"auto",height:t.find(".textme").parent().height()+"px",width:t.find(".textme")[0].scrollWidth+"px"}).removeClass("editingtext"),$(this).find("span").each(function(){var e=$(this).text();$(this).replaceWith(e)}).end().find("div").removeAttr("style").end().html().replace(/&nbsp;/g,"<br/>"),computeGuides(t)),previewMode||useboxer()}),$canvas.delegate("[contenteditable=true]","paste",function(e){e.preventDefault();var t=e.originalEvent.clipboardData.getData("text/plain")||prompt("Paste something..");document.execCommand("insertText",!1,t)}),modernizeWire(),$(".ok").click(editableTextBlurred),$canvas.delegate(".textme","editThisText",edittext),$.widget("ui.boxer",$.extend({},$.ui.mouse,{_init:function(){this.element.addClass("ui-boxer"),this.dragged=!1,this._mouseInit(),this.helper=$(document.createElement("div")).css({background:"rgba(0,0,0,0.7)"}).addClass("ui-boxer-helper"),$dim.html("<b>W</b>: 0px, <b>H</b>: 0px")},destroy:function(){return this.element.removeClass("ui-boxer ui-boxer-disabled").removeData("boxer").unbind(".boxer"),this._mouseDestroy(),this},_mouseStart:function(e){if($(e.target).hasClass("overlay"))return!1;wirepanel.hide(),$canvas.data("drawing-in-progress",!0),e.ctrlKey||e.shiftKey||e.metaKey||$("#canvas .selected").removeClass("selected"),$("#canvas .latestwire").removeClass("latestwire"),$("#lock , #group").removeClass("pressed"),$(".blank").remove();var t=this;if(this.opos=function(e){var a,i,s=$canvas.data("guideV"),n=$canvas.data("guideH");return s?(a=roundHalf(s.x+$canvas.offset().left),t.origSnapX=s.x,$canvas.data("guideV",!1)):a=e.pageX,n?(i=roundHalf(n.y+$canvas.offset().top),t.origSnapY=n.y,$canvas.data("guideH",!1)):i=e.pageY,appSettings.snapToGrid&&gridsize>0&&!e.altKey&&(a=$canvas.offset().left+Math.round((a-$canvas.offset().left)/gridsize)*gridsize,i=$canvas.offset().top+Math.round((i-$canvas.offset().top)/gridsize)*gridsize),[a,i]}(e),!this.options.disabled){var a=this.options;this._trigger("start",e),$(a.appendTo).append(this.helper),this.helper.css({"z-index":99,position:"absolute",left:this.opos[0],top:this.opos[1],width:0,height:0})}},_mouseDrag:function(e){if(!this.selecting&&!e.altKey){var t={x:parseInt((e.pageX-$canvas.offset().left)/zoomfactor),y:parseInt((e.pageY-$canvas.offset().top)/zoomfactor)};snapGuides(t,e)}$(e.target).hasClass("wirejr")&&$(e.target).parent().removeClass("selected");if(this.dragged=!0,!this.options.disabled){var a=(this.options,this.opos[0]),i=this.opos[1],s=$canvas.data("guideH"),n=$canvas.data("guideV");if(s&&s.y!==i&&!this.selecting?(y2=s.y*zoomfactor+$canvas.offset().top,y2=parseInt(y2),this.snappedH=!0):(y2=e.pageY,this.snappedH=!1),n&&n.x!=a&&!this.selecting?(x2=n.x*zoomfactor+$canvas.offset().left,x2=parseInt(x2),this.snappedV=!0):(x2=e.pageX,this.snappedV=!1),appSettings.snapToGrid&&gridsize>0&&!this.selecting&&!e.altKey&&(x2=$canvas.offset().left+Math.round((x2-$canvas.offset().left)/gridsize)*gridsize,y2=$canvas.offset().top+Math.round((y2-$canvas.offset().top)/gridsize)*gridsize),a-x2>3&&i-y2>3?(this.helper.addClass("selecting"),$guidesHV.hide(),this.selecting=!0,$canvas.data("guideH",!1).data("guideV",!1)):(this.helper.removeClass("selecting"),this.selecting=!1),this.lastx1=a,this.lastx2=x2,this.lasty1=i,this.lasty2=y2,a>x2){var r=x2;x2=a,a=r,this.x2corr=!0}else this.x2corr=!1;if(i>y2){var o=y2;y2=i,i=o,this.y2corr=!0}else this.y2corr=!1;this.x1=a,this.y1=i;var d,c;return c=n&&!this.x2corr||this.origSnapX?roundHalf(x2-a)+zoomfactor:roundHalf(x2-a),d=e.shiftKey?c:s&&!this.y2corr||this.origSnapY?roundHalf(y2-i)+zoomfactor:roundHalf(y2-i),this.helper.css({left:a,top:i,width:c,height:d,background:"rgba(31,51,71,.4)"}),(c>5/zoomfactor||d>5/zoomfactor)&&$statsDim.find(".x").text(Math.round(c/zoomfactor)).end().find(".y").text(Math.round(d/zoomfactor)),this._trigger("drag",e),!1}},_mouseStop:function(e){$canvas.data("drawing-in-progress",!1);var t=$canvas.data("guideH"),a=$canvas.data("guideV");if(this.lastx1>this.lastx2){{var i=this.lastx2,s=this.origSnapX;s||this.opos[0]}this.x2=this.x1,this.x1=i,a&&(this.origSnapX=a.x,a=!1),s&&(a.x=s,this.origSnapX=i/zoomfactor-$canvas.offset().left/zoomfactor)}if(this.lasty1>this.lasty2){{var i=this.lasty2,s=this.origSnapY;s||this.opos[1]}this.y2=this.y1,this.y1=i,t&&(this.origSnapY=t.y,t=!1),s&&(t.y=s,this.origSnapY=i/zoomfactor-$canvas.offset().top/zoomfactor)}this.dragged=!1;var n=(this.options,this.x1),r=this.y1,o=$canvaswrap.offset();activepage.find(".wirejr, .grouped").not(".groupmember").length?activepage.find(".wirejr, .grouped").not(".groupmember").each(function(){var e=parseInt($(this).css("zIndex"),10);e>index_highest&&(index_highest=e)}):index_highest=1;var d=n-o.left,c=r-o.top;clonewidth=this.helper.width(),cloneheight=this.helper.height(),0>d&&(d=0),0>c&&(c=0),clonewidth>cwidth&&(clonewidth=cwidth);var l=0,p={left:this.origSnapX?Math.round(this.origSnapX):d-l,top:this.origSnapY?Math.round(this.origSnapY):c-l},h=a&&"col"===a.parent?-1:0;h=0;var g=this.helper.clone().css({left:p.left,top:p.top,width:parseInt(a.x?a.x-p.left+1+h:clonewidth/zoomfactor),height:parseInt(t.y?t.y-p.top+1:cloneheight/zoomfactor),"z-index":index_highest+1}).removeClass("ui-boxer-helper").appendTo(activepage).addClass("brandnew blank");return this.origSnapX=!1,this.origSnapY=!1,a=!1,t=!1,this._trigger("stop",e,{box:g}),this.helper.removeClass("selecting").css("background","transparent").remove(),!1}})),$.extend($.ui.boxer,{defaults:$.extend({},$.ui.mouse.defaults,{appendTo:"body",distance:0})}),$(".page").length)var activepage=$(".page:visible");else var activepage=$("#canvas");previewMode||useboxer(),wirepanel.delegate(".icon","click",function(){var e=$(this);$canvas.find(".brandnew").length&&(type=e.attr("elementtype"),prepareWire()),insertWire()});var type;$canvas.delegate(".wire","mouseenter",function(){var e=$(this);if(e.is(":data(draggable)")||e.is(".multidrag")||e.is(".editingtext")||previewMode||makeDrag(e),e.is(":data(draggable)")){isover=!0;var t=!1;$(document).bind("keydown",function(a){t||(t=!0,a.shiftKey&&1==isover&&e.draggable("disable"))})}}).delegate(".wire","mouseleave",function(e){isover=!1,$(document).unbind("keydown");var t=$(this);t.hasClass("ui-draggable-disabled")&&t.draggable("enable")}).delegate(".wire","contextmenu",function(e){var t=activepage.find(".selected");1===t.length&&t.removeClass("selected"),$(this).addClass("selected")}),$canvas.delegate(".wire","mousedown",function(e){if(1==e.altKey&&e.metaKey){activepage.data("altdrag",!0);var t=activepage.find(".selected");if(1==t.length){var a=t.draggable("option","helper");t.draggable("option","helper","clone").removeClass("selected").addClass("altdrag")}a&&$canvas.droppable({drop:function(e,i){var s=$(i.helper).clone().removeClass("ui-draggable-dragging, ui-resizable");s.appendTo(activepage).addClass("selected").removeClass("altdrag").find(".ui-resizable-handle").remove();var n=[];s.each(function(e){var t="w"+(new Date).getTime()+e;$(this).draggable("destroy").resizable("destroy").attr("id",t),n[e]=t}),historystate.shift(),saveState("",n),computeGuides(s),makeDrag(s),$canvas.droppable("destroy"),t.draggable("option","helper",a),activepage.data("altdrag",!1)}})}});var isover=!1;MakeCanvasDrag(),$("#del").click(function(){delnow()}),$("#edit").click(function(){$("#icons").show().siblings().hide(),$('.icon[elementtype="headlinetxt"]').hide(),positionwirepanel()});var copied;posTopArray=[],posLeftArray=[],$("#copy").click(function(){copynow()}),$("#cut").click(function(){cutnow()}),key("ctrl+c, command+c",function(){activepage.find("[contenteditable=true]").length||copynow()}),key("ctrl+x, command+x",function(){activepage.find("[contenteditable=true]").length||cutnow()}),key("del",function(){delnow()}),key("backspace",function(e){if(!activepage.find("[contenteditable=true]").length){if($(e.target).is("input"))return!1;var t=$(document.activeElement).hasClass("editingtext"),a=$(document.activeElement).hasClass("editor-form-element"),i=$(document.activeElement).hasClass("input"),s=$(".appriseInner").length,n=$ajaxlogin.is(":visible"),r=$canvas.find(".selected").length;if(!(t||a||i||s||r))return!1;!r||t||i||a||s||n||(e.preventDefault(),delnow())}}),$("#paste").click(function(){paste()}),key("ctrl+v, command+v",function(){activepage.find("[contenteditable=true]").length||paste()});var pasteIndex=1;$(".colorpicker").click(function(){var e=$(this).css("background-color");changeBackgroundColor(e)}),$(".strokeweight").click(function(){changeBorderWidth($(this).attr("stroke"))}),$.fn.getId=function(){if($(this).attr("id"))return $(this).attr("id");var e="w"+(new Date).getTime();return $(this).attr("id",e),e},$(".brcolor").click(function(){if(saveState(),$(".selected").has(".wirejr").length)var e=activepage.find(".selected").not(".locked").find(".wirejr");else var e=$canvas.find(".selected").not(".locked");current_brcolor=$(this).css("border-left-color"),e.css("border-color",current_brcolor),e.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor),e.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor)}),$("#front").click(function(){bring_to_front()}),$("#back").click(function(){send_to_back()}),$("#backward").click(function(){send_backward()}),$("#forward").click(function(){bring_forward()});var $showbg=$("#wirepanel #show-bg"),$strokes=$("#wirepanel #strokes"),$showborderbg=$("#wirepanel #show-border , #show-bg"),$colorpickers=$("#wirepanel #colorpickers"),$bordercolors=$("#wirepanel #bordercolors"),$edittxt=$("#wirepanel #edittxt"),$textalsz=$("#wirepanel #textalign , #wirepanel #textsize");$("#show-bg").click(function(){$("#colorpickers").show(),$("#bordercolors").hide(),$("#show-border").show(),$("#show-bg").hide()}),$("#show-border").click(function(){$("#bordercolors").show(),$("#colorpickers").hide(),$("#show-border").hide(),$("#show-bg").show()}),$("#alignleft").click(function(){saveState(),activepage.find("[contenteditable=true] , .selected .paragraph span").css("text-align","left")}),$("#aligncenter").click(function(){saveState(),activepage.find("[contenteditable=true] , .selected .paragraph span").css("text-align","center")}),$("#alignright").click(function(){saveState(),activepage.find("[contenteditable=true] , .selected .paragraph span").css("text-align","right")}),$("#alignjustify").click(function(){saveState(),activepage.find("[contenteditable=true] , .selected .paragraph span").css("text-align","justify")}),$("#font-s").click(function(){if(saveState(),activepage.find(".selected.paragraph span , .selected .paragraph span").css({"font-size":"7px","line-height":"13px"}),activepage.find(".selected.list span ul li span ,  .selected .list span ul li span").css({"font-size":"7px","line-height":"13px"}),activepage.find("[contenteditable=true]").css({"font-size":"12px"}),activepage.find("[contenteditable=true]").length){var e=activepage.find("[contenteditable=true]");e.css({"font-size":"12px"}),e.parent().css("height",e.height()),e.focus()}activepage.find(".selected .headline").find(".headtext span ").css({"font-size":"14px","line-height":"14px","margin-bottom":"2px"})}),$("#font-m").click(function(){if(saveState(),activepage.find(".selected .paragraph span").css({"font-size":"10px","line-height":"20px"}),activepage.find(".selected .list span ul li span").css({"font-size":"10px","line-height":"20px"}),activepage.find(".selected.headlinetxt .editable .content-wrapper").css({"font-size":"18px","line-height":"18px"}),activepage.find("[contenteditable=true]").length){var e=activepage.find("[contenteditable=true]");e.css({"font-size":"18px"}),e.parent().css("height",e.height()),e.focus()}activepage.find(".selected .headline").find(".headtext span").css({"font-size":"22px","line-height":"22px","margin-bottom":"6px"})}),$("#font-l").click(function(){if(saveState(),activepage.find(".selected .paragraph span").css({"font-size":"18px","line-height":"36px"}),activepage.find(".selected .list span ul li span").css({"font-size":"18px","line-height":"36px"}),activepage.find(".selected.headlinetxt .editable .content-wrapper").css({"font-size":"28px","line-height":"28px"}),activepage.find("[contenteditable=true]").length){var e=activepage.find("[contenteditable=true]");e.css({"font-size":"28px"}),e.parent().css("height",e.height()),e.focus()}activepage.find(" .selected .headline").find(".headtext span ").css({"font-size":"28px","line-height":"28px","margin-bottom":"8px"})}),jQuery.fn.center=function(e){var e=this.parent(),t=Math.round(($(e).width()-this.outerWidth())/2);return 0>t&&(t=10),this.css({left:t+"px","margin-left":"0"}),this};var annotationhtml="<span class=annotbox><div class='editme thelatest'></div><button class=ok><i class=icon-ok></i> ok</button></span><div class=closeannot><i class=icon-remove></i></div>",texthtml="<span class='text'><div class='textme thelatest'></div></span>",paragraph="<span class=txtcont><span>Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iise mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.</span></span>",paragraphtext="Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.",list="<span class='listcont'><ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul></span>",listhtml="<ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul>",headtxt="<span class='headtext'><span>Lorem</span> <span>ipsum</span> <span>dolor</span> <span>sitammet</span> <span>quam</span> <span>Lorem</span> <span>ipsumdolor</span> <span>sitammet</span> <span>quam</span></span>",img="<svg id='imgwire' version='1.1' baseProfile='tiny'  xmlns='http://www.w3.org/2000/svg'  width='200px' height='100px' viewBox='0 0 200 100' preserveAspectRatio='none'><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='100' x2='200' y2='0'/><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='0' x2='200' y2='100'/></svg>";$("#watch-demo").click(function(){$(".panel").is(":visible")||demo0()}),previewMode?$("#canvas .publiccomment .annotbox div").click(divClicked):$("#canvas .annotbox div").click(divClicked),$canvas.find(".aa").length&&$("#hide-annotation").show(),$canvas.find(".aa:hidden").length&&($("#hide-annotation").hide(),$("#show-annotation").show());var delay=function(){var e=0;return function(t,a){clearTimeout(e),e=setTimeout(t,a)}}();$(window).resize(function(){delay(function(){$canvaswrap.center()},500)}),$("#grid-slider").slider({min:10,max:50,value:20,slide:function(e,t){$(".grid-size-val").text(t.value)},stop:function(e,t){updategrid(t.value),turngridon()}}),$("#snap-to-grid").change(function(){turngridon(),this.checked?($snaptoguides.attr("checked",!1),appSettings.snapToGuides=!1,appSettings.snapToGrid=!0,$canvaswrap.attr({"data-grid-snap":"true"})):($canvaswrap.attr("data-grid-size",0),gridsize=0,appSettings.snapToGrid=!1,$canvaswrap.attr({"data-grid-snap":"false"}))}),$canvaswrap.data("savedState",[]),$canvaswrap.data("savedUndo",[]);var historystate=$canvaswrap.data("savedState"),future=$canvaswrap.data("savedUndo");key("ctrl+z, command+z",function(e){e.preventDefault(),restoreState(!0)}),$("#undo").click(function(){restoreState(!0)}),key("ctrl+y, command+y, command+shift+z",function(e){e.preventDefault(),restoreState(!1)}),$("#redo").click(function(){restoreState(!1)}),$("#canvas").mousemove(function(e){$(".coord").html("<b>X</b>: "+parseInt(e.pageX-offset_c.left,10)+" <b>Y</b>: "+parseInt(e.pageY-offset_c.top,10))}),sett.bind("click",function(e){wirepanel.hide(),$container.hasClass("slide-down")?$container.removeClass("slide-down").delay(600).queue(function(e){sharebar.hide(),sett.toggleClass("pressed"),exportbtn.removeClass("pressed"),$container.toggleClass("slide-left"),e()}):(sharebar.hide(),exportbtn.removeClass("pressed"),$container.removeClass("slide-right , slide-down"),$container.toggleClass("slide-left"),$(this).toggleClass("pressed "),$(this).find("i").toggleClass("icon-arrow-right"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"))}),$("select#def-stroke-width").change(function(e){defbw=$("select#def-stroke-width").val()}),$("select#def-stroke-color").change(function(e){defstrcolor=$("select#def-stroke-color").val()}),$("select#def-bg-color").change(function(e){defbgcolor=$("select#def-bg-color").val()}),$("#canvas_w_val").change(function(){var e=parseInt($(this).val(),10);changePageSize(e,!1),$canvaswrap.center()}),$("#canvas_h_val").change(function(){var e=parseInt($(this).val(),10);changePageSize(!1,e)}),key("down",function(e){activepage.find("[contenteditable=true]").length||handleKeys(e)}),key("up",function(e){activepage.find("[contenteditable=true]").length||handleKeys(e)}),key("left",function(e){activepage.find("[contenteditable=true]").length||handleKeys(e)}),key("right",function(e){activepage.find("[contenteditable=true]").length||handleKeys(e)}),$("#group").click(function(){group_ungroup()}),key("ctrl+g, command+g",function(e){if(e.preventDefault(),multipaged)var t=activepage.find(".selected").not(".locked");else var t=$canvas.find(".selected").not(".locked");group_elements(t)}),key("ctrl+shift+g, command+shift+g",function(e){e.preventDefault(),ungroup_elements($("#canvas .selected.grouped"))}),$("#align-top").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length)e.css("top","1px");else{var t=1e4;e.each(function(){var e=$(this).position();t=t<e.top?t:e.top}),e.css("top",t+"px")}computeGuides(e)}),$("#align-left").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length)e.css("left","1px");else{var t=1e4;e.each(function(){var e=$(this).position();t=t<e.left?t:e.left}),e.css("left",t+"px")}computeGuides(e)}),$("#align-right").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length){var t=$("#canvas").width(),a=e.width(),i=parseInt(e.css("borderWidth"),10);e.css("left",t-a-2*i+1+"px")}else{var s=-1;e.each(function(){var e=$(this).position(),t=$(this).width();s=s>e.left+t?s:e.left+t}),e.each(function(){var e=$(this).width();$(this).css("left",s-e+"px")})}computeGuides(e)}),$("#align-bottom").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length){var t=$("#canvas").height(),a=e.height(),i=parseInt(e.css("borderWidth"),10);e.css("top",t-a-2*i+1+"px")}else{var s=-1;e.each(function(){var e=$(this).position(),t=$(this).height();s=s>e.top+t?s:e.top+t}),e.each(function(){var e=$(this).height();$(this).css("top",s-e+"px")})}computeGuides(e)}),$("#align-center").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length){var t=$("#canvas").height(),a=e.height();e.css("top",t/2-a/2+"px")}else{var i=-1,s=1e3;e.each(function(){var e=$(this).position(),t=$(this).height();i=i>e.top+t?i:e.top+t,s=s<e.top?s:e.top}),e.each(function(){var e=$(this).height();$(this).css("top",(i+s)/2-e/2+"px")})}computeGuides(e)}),$("#align-middle").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length){var t=$("#canvas").width(),a=e.width();e.css("left",t/2-a/2+"px")}else{var i=-1,s=1e3;e.each(function(){var e=$(this).position(),t=$(this).width();i=i>e.left+t?i:e.left+t,s=s<e.left?s:e.left}),e.each(function(){var e=$(this).width();$(this).css("left",(i+s)/2-e/2+"px")})}computeGuides(e)}),$("#dist-v").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");saveState(e);var t=0;divide=e.length-1,obj=e,distrb=sortdivs(obj,"top"),maxTop=distrb[0].val+distrb[0].div.height()/2,last=distrb.length-1,maxBottom=distrb[last].val+distrb[last].div.height()/2,$.each(distrb,function(){thisdiv=this.div;var e=thisdiv.height();thisdiv.css("top",maxTop+(maxBottom-maxTop)/divide*t-e/2+"px"),t++}),computeGuides(e)}),$("#dist-h").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");saveState(e);var t=0;divide=e.length-1,obj=e,distrb=sortdivs(obj,"left"),maxLeft=distrb[0].val+distrb[0].div.width()/2,last=distrb.length-1,maxRight=distrb[last].val+distrb[last].div.width()/2,$.each(distrb,function(){thisdiv=this.div;var e=thisdiv.width();thisdiv.css("left",maxLeft+(maxRight-maxLeft)/divide*t-e/2+"px"),t++}),computeGuides(e)}),$("#align").click(function(){$container.addClass("top-dd-active"),$(".align-icons").toggleClass("visible"),!$("#arrange-icons").hasClass("visible"),$(this).hasClass("pressed")&&$container.removeClass("top-dd-active"),$(this).toggleClass("pressed"),$("#arrange-icons").hasClass("visible")&&($("#arrange-icons").removeClass("visible"),$("#arrange").removeClass("pressed"))}),$("#arrange").click(function(){$container.addClass("top-dd-active"),$("#arrange-icons").toggleClass("visible"),!$(".align-icons").hasClass("visible"),$(this).hasClass("pressed")&&$container.removeClass("top-dd-active"),$(this).toggleClass("pressed"),$(".align-icons").hasClass("visible")&&($(".align-icons").removeClass("visible"),$("#align").removeClass("pressed"))}),$(".inner-btn , #align , #arrange , .pagename-wrap , .appriseInner").click(function(e){e.stopPropagation()}),key("b",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="box",prepareWire(),insertWire())}),key("r",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="roundbox",prepareWire(),insertWire())}),key("e",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="elipse",prepareWire(),insertWire())}),key("i",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="image",prepareWire(),insertWire())}),key("p",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="paragraph",prepareWire(),insertWire())}),key("l",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="list",prepareWire(),insertWire())}),key("h",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="headline",prepareWire(),insertWire())}),key("t",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="headlinetxt",prepareWire(),insertWire())}),key("a",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="annotate",prepareWire(),insertWire())}),key("g",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="line_hor",prepareWire(),insertWire())}),key("v",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="line_vert",prepareWire(),insertWire())}),key("s",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="slider",prepareWire(),insertWire())}),key("u",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="progressbar",prepareWire(),insertWire())}),key("c",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="combobox",prepareWire(),insertWire())}),key("q",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="scrollh",prepareWire(),insertWire())}),key("y",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="scrollv",prepareWire(),insertWire())}),key("n",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="textinput",prepareWire(),insertWire())}),key("6",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(),insertWire(),activepage.find(".latestwire").css({background:"#111","border-color":"#111"})),activepage.find(".selected").length&&(console.log("bg"),changeBackgroundColor("#111")))}),key("5",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(),insertWire(),activepage.find(".latestwire").css({background:"#444","border-color":"#444"})),activepage.find(".selected").length&&changeBackgroundColor("#444"))}),key("4",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(),insertWire(),activepage.find(".latestwire").css({background:"#777","border-color":"#777"})),activepage.find(".selected").length&&changeBackgroundColor("#777"))}),key("3",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(),insertWire(),activepage.find(".latestwire").css({background:"#aaa","border-color":"#aaa"})),activepage.find(".selected").length&&changeBackgroundColor("#aaa"))}),key("2",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(),insertWire(),activepage.find(".latestwire").css({background:"#ddd","border-color":"#ddd"})),activepage.find(".selected").length&&changeBackgroundColor("#ddd"))}),key("1",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",
prepareWire(),insertWire(),activepage.find(".latestwire").css({background:"#fff","border-color":"#fff"})),activepage.find(".selected").length&&changeBackgroundColor("#fff"))}),key("7",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(),insertWire(),activepage.find(".latestwire").css({background:"tomato","border-color":"tomato"})),activepage.find(".selected").length&&changeBackgroundColor("tomato"))}),key("0",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&activepage.find(".selected").length&&changeBackgroundColor("transarent")}),key("alt+7",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("tomato")}),key("alt+1",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("white")}),key("alt+2",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#ddd")}),key("alt+3",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#aaa")}),key("alt+4",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#777")}),key("alt+5",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#444")}),key("alt+6",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#111")}),key("alt+0",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("transparent")}),key("ctrl+1",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderWidth("1")}),key("ctrl+2",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderWidth("2")}),key("ctrl+3",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderWidth("4")}),key("ctrl+a, command+a",function(e){e.preventDefault(),multipaged?$(".page:visible .wire").not(".locked , .groupmember").addClass("selected"):$(".wire").not(".locked , .groupmember").addClass("selected")}),key("esc",function(e){e.preventDefault(),activepage.find("[contenteditable=true]").length&&activepage.find("[contenteditable=true]").trigger("blur"),$(".selected").removeClass("selected")}),$(".container").hasClass("preview")||renderContextMenu(),key("ctrl+up, command+up",function(e){e.preventDefault(),bring_forward()}),key("ctrl+shift+up, command+shift+up",function(e){e.preventDefault(),bring_to_front()}),key("ctrl+shift+down, command+shift+down",function(e){e.preventDefault(),send_to_back()}),key("ctrl+down, command+down",function(e){e.preventDefault(),send_backward()}),key("ctrl+l, command+l",function(e){e.preventDefault(),lock()}),key("ctrl+k, command+k",function(e){e.preventDefault(),makeLink()});var pagelist=$(".sitemap > ol");if(multipaged)pagelist.empty(),$(".page").each(function(){var e=$(this);e[0].hasAttribute("data-hidden")||e.attr("data-hidden","false");var t=e.attr("data-parent-id")||0,a=0!=t?pagelist.find("[data-pageid="+t+"]"):pagelist;0==t||a.find("ol").length||a.addClass("dd-parent").append("<ol>").addClass("dd-list"),0!=t&&(a=a.find("ol").first()),e.data("hidden")&&previewMode||a.append($("<li>").addClass("dd-item").addClass(function(){return e.hasClass("tree-collapsed")?"tree-collapsed":!1}).attr({"data-pageid":e.attr("id"),"data-hidden":e.attr("data-hidden")||"false"}).html("<div class=dd-handle title='"+e.attr("data-pagename")+"' >"+e.attr("data-pagename")+"</div><span class='hidepage tooltip-smp' data-hint></span>"))}),previewMode&&!pagelist.find("li").length&&pagelist.append("No published pages."),$(".sitemap").nestable().perfectScrollbar(),$(".share-export").perfectScrollbar(),$(".options").perfectScrollbar(),previewMode&&pagelist.find(".dd-parent").each(function(e,t){$(t).find("> ol li:not([data-hidden=true])").length||$(t).removeClass("dd-parent").find(" > ol, button").remove()}),pagelist.find(".tree-collapsed button[data-action=collapse]").click();else{$(".options").perfectScrollbar();var w=parseInt($canvaswrap.width(),10)+250;w<$(window).width()&&(w=$(window).width()),supercanvas.css({width:w+"px",height:parseInt($canvaswrap.height(),10)+750+"px"})}$(".addpage").click(add_new_page),$(".pagename-wrap").find(".pagename, .sitemap-icon").click(function(){$guidesHV.hide(),wirepanel.hide(),$container.hasClass("slide-down")?$container.removeClass("slide-down").delay(600).queue(function(e){sharebar.hide(),$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"),exportbtn.removeClass("pressed"),$container.toggleClass("slide-right"),e()}):($container.removeClass("slide-left , slide-down"),sett.removeClass("pressed"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sharebar.hide(),$container.toggleClass("slide-right"),$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"))}),$("#delete-page").click(function(){$(".sitemap li").length>1?apprise("Are you sure that you want to delete this page?</br>If it contains any nested pages, they will be removed as well.",{verify:!0},function(e){if(!e)return!1;var t=$(".sitemap .activepage"),a=t.parents("li"),i=t.attr("data-pageid");t.find("li").each(function(e,t){var a=$(t).data("pageid");$(".page#"+a).remove()}),$("#"+i).remove(),t.remove(),a.hasClass("dd-parent")&&!a.find("li").length&&(console.log("empty parent"),a.removeClass("dd-parent").find("button,ol").remove());var s=$(".sitemap li").eq(0).attr("data-pageid");make_page_active(s)}):apprise("You can't delete the only page in the project")}),$("#duplicate-page").click(function(){apprise("Enter new name",{verify:!0,input:!0},function(e){if(!e)return!1;e=escapeHtml(e),$canvas.find(".selected").removeClass("selected");var t=activepage.data("template"),a=$.now(),i=$(".sitemap .activepage").attr("data-pageid"),s=$("#"+i);$("#canvas").append($("<div>").addClass("page").attr({id:a,"data-pagename":e,"data-template":t}));var n=s.clone(!0,!0);n.find(".wire").find(".ui-resizable-handle").remove(),$.each(n.find(".wire"),function(e){var t="w"+$.now()+e;$(this).attr("id",t)});var r={width:s.data("page-width"),height:s.data("page-height")};$("#"+a).append(n.html()).attr({"data-page-width":r.width,"data-page-height":r.height,"data-hidden":"false"}),$("#"+a+" .closeannot").click(function(){var e=$(this).parent();e.remove()}),pagelist.append($("<li>").attr({"data-pageid":a,"data-hidden":"false"}).addClass("dd-item").append($("<div/>").text(e).addClass("dd-handle").attr("title",e)).append("<span class='hidepage tooltip-smp' data-hint></span>")),make_page_active(a,e)})}),function(){$canvas.find(".wire").each(function(e){$('[id="'+this.id+'"]').length>1&&$('[id="'+this.id+'"]').not($(this)).each(function(e){this.id+=e})})}(),$("#rename-page").click(function(){apprise("Enter new name",{verify:!0,input:!0},function(e){if(!e)return!1;e=escapeHtml(e);var t=$(".sitemap .activepage"),a=t.attr("data-pageid");$("#"+a).attr({"data-pagename":e}),t.find(".dd-handle").text(e),make_page_active(a,e)})}),$("#Link").click(function(){makeLink()}),$("#preview").click(function(){preview()}),$("#re-edit").click(function(){previewMode=!1,makeEditable(),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sett.removeClass("pressed"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap")}),$(".linkmark").click(function(e){e.stopPropagation(),$("#Link").click()});var gotopage=function(e){e.stopPropagation();var t=$(this).attr("data-link");0!=t&&make_page_active(t)};$("#export-btn").click(function(){$canvas.find(".wire,.aa").draggable("destroy").resizable("destroy");var e=$("#include-frame").is(":checked"),t=$("#export-scale").val();if($canvaswrap.resizable("destroy"),Boolean(parseInt($("#export-all-pages").val())))var a=$canvaswrap.clone().find(".page[data-hidden=true]").remove().end();else var a=$canvaswrap.clone().find("#"+activepage.attr("id")).siblings().remove().end().end();var i=a.outerHTML(),s=encodeURIComponent(i);exporting.show(),$.post("../export_png_pdf.php",{data:s,id:filename,extension:$("#export-format input[type='radio']:checked").val(),name:$("title").text(),frame:e,resolution:t},function(e){$("iframe").attr("src","../download-png-pdf.php?f="+e),MakeCanvasDrag(),exporting.hide()})});var sharebar=$(".sharebar"),exportbtn=$(".export");exportbtn.click(function(){exportbtn.toggleClass("pressed"),window.scrollTo(0,0),$container.hasClass("slide-left")||$container.hasClass("slide-right")?$container.removeClass("slide-left , slide-right").delay(600).queue(function(e){sharebar.show(),$(this).toggleClass("slide-down"),sett.removeClass("pressed"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),e()}):(sharebar.show(),$container.toggleClass("slide-down"))}),previewMode&&$(".ui-boxer").boxer("destroy"),0==$("#"+activepage.attr("id")+" ~ .page:not([data-hidden=true])").length&&$("#next").addClass("inactive"),0==activepage.prevAll(".page:not([data-hidden=true])").length&&$("#prev").addClass("inactive"),$("#next").click(function(){if($(this).hasClass("inactive"))return!1;$("#prev").removeClass("inactive");var e=$("#"+activepage.attr("id")+" ~ .page:not([data-hidden=true])");e.length&&(make_page_active(e.first().attr("id")),$("#"+activepage.attr("id")+" ~ .page:not([data-hidden=true])").length||$(this).addClass("inactive"))}),$("#prev").click(function(){if($(this).hasClass("inactive"))return!1;$("#next").removeClass("inactive");var e=($(".page:visible"),activepage.prevAll(".page:not([data-hidden=true])").first());e&&(make_page_active(e.attr("id")),0==activepage.prevAll(".page:not([data-hidden=true])").length&&$(this).addClass("inactive"))}),$(".addComment").click(function(){$("#canvas .page:visible").append($("<div class='publiccomment'/>").css({width:"160px",height:"120px",top:"40px",left:"60px","z-index":5e3,position:"absolute"}).append(annotationhtml)),$(".editme").click(divClicked),$("#canvas .thelatest").click(),$("#canvas .closeannot").click(function(){var e=$(this).parent();e.remove(),saveComment()})});var $savecomment=$(".saveComment");$(document).keyup(function(e){27==e.keyCode&&(wirepanel.hide(),$(".blank").remove())}),jQuery.fn.outerHTML=function(e){return e?this.before(e).remove():jQuery("<p>").append(this.eq(0).clone()).html()},window._link_was_clicked=!1,jQuery(document).delegate("a","click",function(e){window._link_was_clicked=!0}),$.fn.hasAttr=function(e){return void 0!==this.attr(e)},jQuery.fn.htmlClean=function(){return this.contents().filter(function(){return 3!=this.nodeType?($(this).htmlClean(),!1):(this.textContent=$.trim(this.textContent),!/\S/.test(this.nodeValue))}).remove(),this},$canvas.delegate(".grouped:not(.groupmember)","click",function(e){previewMode||(e.ctrlKey||e.shiftKey||e.metaKey||$canvas.find(".selected").removeClass("selected"),$(e.target).closest(".grouped").toggleClass("selected"))}),$(".grouped:empty").remove(),multipaged&&$("#canvas").boxer("destroy"),function(){if(!multipaged){var e=$canvas.height();return e>600&&$(".container").css({"overflow-y":"auto"}),!1}var t=$canvas.find(".page:visible"),a=$canvaswrap.height(),i=$canvaswrap.width(),s="browser-wrap";$canvaswrap.hasClass("mobile")&&!$canvaswrap.hasClass("tablet")&&(s="mobile"),$canvaswrap.hasClass("mobile-landscape")&&(s="mobile-landscape"),$canvaswrap.hasClass("tablet")&&(s="mobile tablet"),$canvas.find(".page").show().each(function(e){var t=$(this);t.attr("data-page-width")||t.attr({"data-page-width":i,"data-page-height":a}),t.attr("data-template")||t.attr("data-template",s),t.css({height:"100%",width:"100%"})}).hide(),make_page_active(t.attr("id"));var n=t.data("template");"browser-wrap"!==n&&$("[data-template-btn="+n+"]").insertBefore($("[data-template-btn]:first"))}(),key("ctrl+s, command+s",function(e){previewMode||(e.preventDefault(),$("#save").click())}),previewMode&&$(".overlay").bind("click",function(){($container.hasClass("slide-left")||$container.hasClass("slide-right")||$container.hasClass("slide-down"))&&($container.removeClass("slide-left , slide-right , slide-down"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),$("#top .settings.pressed").removeClass("pressed"),$("#top .export.pressed").removeClass("pressed"))}),$canvas.find(".multidrag").removeClass("multidrag");var $copyBtn=$("#copy-preview-link span"),clipboard=new Clipboard("#copy-preview-link");clipboard.on("success",function(e){$copyBtn.addClass("icon-ok").delay(600).queue(function(){$(this).removeClass("icon-ok").clearQueue()}),e.clearSelection()}),clipboard.on("error",function(e){}),navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)&&$copyBtn.parent().remove(),$(".closeabout, #about-wrap").click(function(){$("body").removeClass("show-about"),localStorage.setItem("about-closed",!0)}),$("#about-wrap").children().click(function(e){e.stopPropagation()}),$("#about-btn").click(function(e){e.preventDefault(),$("body").addClass("show-about"),wirepanel.hide()}),$.support.transition||($.fn.transition=$.fn.animate);var d1=$("#d1"),dw=$(".demowrap"),c=$("#cursor"),wp=$(".feux-wirepanel"),fc=$(".feux-canvas");$("#feux-play").bind("click",function(){$(this).hide(),dw.show(),localStorage.setItem("demo-watched",!0),demoStart()});var draggingInProgress=!1,zoomfactor=1,oldMath=0;$canvas.bind("mousemove",$.throttle(50,function(e){if(draggingInProgress||$(this).is('[class*="slide-"]'))return!1;var t=10,a=10,i=Math.round(Math.sqrt(Math.pow(t-e.clientY,2)+Math.pow(a-e.clientX,2)))+"px",s=Math.abs(parseInt(i)-oldMath);oldMath=parseInt(i);var n={x:parseInt((e.pageX-$canvas.offset().left)/zoomfactor),y:parseInt((e.pageY-$canvas.offset().top)/zoomfactor)};appSettings.snapOnDraw&&!$canvas.data("drawing-in-progress")&&!resizingInProgress&&wirepanel.is(":hidden")&&!e.altKey&&3>s&&snapGuides(n,e),(e.altKey||s>=3)&&hideGuidesAndMarkers(),$statsCoord.find("span.x").html(n.x).end().find("span.y").html(n.y)})).bind("mouseleave",function(){$guidesHV.hide()}),previewMode&&$canvas.unbind("mousemove");var guides;previewMode||computeGuides("#canvas"),$(".overlay").bind("click",function(e){return e.preventDefault(),e.stopPropagation(),$container.removeClass("slide-left , slide-right , slide-down , top-dd-active"),$("#arrange, #align").removeClass("pressed"),$("#arrange-icons, .align-icons").removeClass("visible"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),$("#top .settings.pressed").removeClass("pressed"),$("#top .export.pressed").removeClass("pressed"),!1}),$snaptoguides.bind("change",function(){appSettings.snapToGuides=this.checked,this.checked&&(appSettings.snapToGrid=!1,$snaptogrid.attr("checked",!1),$canvaswrap.attr({"data-grid-size":0,"data-grid-snap":"false"}),gridsize=0,appSettings.snapToGrid=!1),$guidesHV.hide()}),$selectgridtype.change(function(){"graph"==$selectgridtype.val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$showgrid.attr("checked","checked"),$canvaswrap.attr("data-grid-type","graph"),appSettings.snapToCol=!1,appSettings.snapToGrid=!0,removeGuides(".col")):"dots"==$selectgridtype.val()?($("#grid-dot").show(),$("#gridcol, #grid-div").hide(),$showgrid.attr("checked","checked"),$canvaswrap.attr("data-grid-type","dots"),appSettings.snapToCol=!1,appSettings.snapToGrid=!0,removeGuides(".col")):($("#gridcol").show(),$("#grid-div , #grid-dot").hide(),$showgrid.attr("checked","checked"),$canvaswrap.attr("data-grid-type","col"),appSettings.snapToGrid=!1,appSettings.snapToCol=!0,computeGuides("col"))}),$drawsnap.bind("change",function(){console.info(this.checked),appSettings.drawSnap=this.checked,$guidesHV.hide()}),$transformsnap.bind("change",function(){console.info(this.checked),appSettings.transformSnap=this.checked,$guidesHV.hide()}),$container.scroll($.debounce(250,function(){previewMode||computeGuides(activepage.find(" > .wire"))})).perfectScrollbar(),$canvaswrap.bind("mouseleave",function(){$guidesHV.hide()}),$(".sitemap").delegate(".hidepage","click",function(e){var t=$(this).parent();hidePageFromPreview(t)}),previewMode&&supercanvas.bind("click",function(){$container.removeClass("slide-right")}),$container.scroll($.debounce(250,!0,function(){$(this).addClass("ps-scrolling")})),$container.scroll($.debounce(750,function(){$(this).removeClass("ps-scrolling")})),jQuery.fn.getShowingText=function(){var e=$(this).width();$("body").append('<div id="TestText" style="padding:0;border:0;height:auto;width:'+e+'px;position:absolute;display:none;"></div>');for(var t=$(this).innerHeight(),a=0,i="Lorem",s=!1,n=$("#TestText"),r=(n.innerHeight(),0),o="Lorem",d=1;d<paragraphArr.length&&t+r>=a;d++)o+=" "+paragraphArr[d],n.text(o),a=n.innerHeight(),i+=" "+paragraphArr[d],d===paragraphArr.length&&(s=!0);return n.remove(),s===!1?{text:paragraphArr.slice(0,d).join(" "),count:d-1}:paragraphtext};var paragraphArr=["Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel.","Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel.","Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel.","Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel."];jQuery.fn.selectText=function(){if($.browser.mozilla){var e=document,t=this[0];if(e.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(t),a.select()}else if(window.getSelection){var i=window.getSelection(),a=document.createRange();a.selectNodeContents(t),i.removeAllRanges(),i.addRange(a)}}else document.execCommand("selectAll",!1,null)},wirepanel.delegate(".text-edit-btn","click",function(e){mousedownHappened=!1,activepage.find("[contenteditable=true]").focus()}),wirepanel.mousedown(function(){mousedownHappened=!0,activepage.find("[contenteditable=true]").focus()}),$canvas.delegate("[data-lorem-count] .textme","input",function(e){$(this).closest(".wirejr").removeAttr("data-lorem-count").parent().removeClass("text-lorem")}),populateLoremText(),$canvas.find("div.brandnew").remove();